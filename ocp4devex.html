<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<meta name="author" content="DSA Team &lt;ilawson@redhat.com&gt;">
<title>OpenShift 4.x DevEx Workshop</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock pre.nowrap,.literalblock pre.nowrap pre,.listingblock pre.nowrap,.listingblock pre.nowrap pre{white-space:pre;word-wrap:normal}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #dddddf}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>OpenShift 4.x DevEx Workshop</h1>
<div class="details">
<span id="author" class="author">DSA Team</span><br>
<span id="email" class="email"><a href="mailto:ilawson@redhat.com">ilawson@redhat.com</a></span><br>
<span id="revnumber">version 1.0.0,</span>
<span id="revdate">January 08, 2020</span>
<br><span id="revremark">Draft</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#intro">Introduction</a>
<ul class="sectlevel2">
<li><a href="#attendee-details">Attendee details</a>
<ul class="sectlevel3">
<li><a href="#what-is-openshift">What is Openshift</a></li>
<li><a href="#links">Links</a></li>
<li><a href="#contributors">Contributors</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#application-basics">Application Basics</a>
<ul class="sectlevel2">
<li><a href="#introduction">Introduction</a></li>
<li><a href="#starting-up-logging-on-and-creating-a-project">Starting up - logging on and creating a project</a></li>
<li><a href="#creating-your-first-application">Creating your first Application</a></li>
<li><a href="#adding-additional-applications">Adding additional Applications</a></li>
<li><a href="#interacting-with-openshift-through-the-command-line">Interacting with OpenShift through the Command Line</a>
<ul class="sectlevel3">
<li><a href="#option-1-installing-the-cli-on-localhost">Option 1: Installing the CLI on localhost</a></li>
<li><a href="#option-2-use-a-pre-configured-docker-image-on-openshift">Option 2: Use a pre-configured docker image on OpenShift</a></li>
</ul>
</li>
<li><a href="#setup-login">Using your terminal (Both options)</a></li>
<li><a href="#a-summary-of-application-interactions">A Summary of Application Interactions</a></li>
</ul>
</li>
<li><a href="#understanding-deployments-and-configuration">Understanding Deployments and Configuration</a>
<ul class="sectlevel2">
<li><a href="#introduction-2">Introduction</a></li>
<li><a href="#introducing-deployment-configurations">Introducing Deployment Configurations</a></li>
<li><a href="#dependency-injection-using-config-maps">Dependency Injection using Config Maps</a></li>
<li><a href="#dependency-injection-of-sensitive-information-using-secrets">Dependency Injection of sensitive information using Secrets</a></li>
<li><a href="#understanding-the-deployment-strategies">Understanding the Deployment Strategies</a></li>
</ul>
</li>
<li><a href="#application-deployment-configurations-and-devops-approaches">Application Deployment Configurations and DevOps Approaches</a>
<ul class="sectlevel2">
<li><a href="#introduction-3">Introduction</a>
<ul class="sectlevel3">
<li><a href="#workshop-content">Workshop Content</a></li>
<li><a href="#creation-of-version-1">Creation of version 1</a></li>
<li><a href="#creation-of-version-2">Creation of version 2</a></li>
</ul>
</li>
<li><a href="#blue-green-deployment">Blue / Green Deployment</a></li>
<li><a href="#ab-deployment">A/B Deployment</a>
<ul class="sectlevel3">
<li><a href="#cleaning-up">Cleaning up</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#understanding-the-software-defined-network-within-openshift">Understanding the Software Defined Network within OpenShift</a>
<ul class="sectlevel2">
<li><a href="#introduction-4">Introduction</a></li>
<li><a href="#the-basics-of-service-addressing">The basics of Service Addressing</a></li>
<li><a href="#using-the-shorthand-service-name-directly">Using the shorthand Service name directly</a></li>
<li><a href="#using-the-fully-qualified-domain-name-for-accessing-services">Using the Fully Qualified Domain Name for accessing Services</a></li>
<li><a href="#controlling-access-through-network-policies">Controlling Access through Network Policies</a></li>
</ul>
</li>
<li><a href="#the-rbac-model-for-developers">The RBAC model for Developers</a>
<ul class="sectlevel2">
<li><a href="#introduction-5">Introduction</a></li>
<li><a href="#examining-service-accounts">Examining Service Accounts</a></li>
<li><a href="#adding-role-bindings-to-your-namespaceproject">Adding Role Bindings to your namespace/project</a></li>
<li><a href="#giving-users-lower-levels-of-permission">Giving Users lower levels of permission</a></li>
</ul>
</li>
<li><a href="#understanding-persistent-volumes">Understanding Persistent Volumes</a>
<ul class="sectlevel2">
<li><a href="#introduction-6">Introduction</a></li>
<li><a href="#adding-a-persistent-volume-to-an-application">Adding a Persistent Volume to an Application</a></li>
<li><a href="#demonstrating-survivability-of-removal-of-all-pods">Demonstrating survivability of removal of all Pods</a></li>
</ul>
</li>
<li><a href="#healthprobes">Pod Health Probes</a>
<ul class="sectlevel2">
<li><a href="#introduction-7">Introduction</a></li>
<li><a href="#creating-the-project-and-application">Creating the project and application</a></li>
<li><a href="#viewing-the-running-application">Viewing the running application</a></li>
<li><a href="#liveness-probe">Liveness Probe</a>
<ul class="sectlevel3">
<li><a href="#activation-of-the-liveness-prove">Activation of the Liveness Prove</a></li>
</ul>
</li>
<li><a href="#readiness-probe">Readiness Probe</a>
<ul class="sectlevel3">
<li><a href="#activation-of-the-readiness-probe">Activation of the Readiness Probe</a></li>
<li><a href="#cleaning-up-2">Cleaning up</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#openshift-do">OpenShift DO</a>
<ul class="sectlevel2">
<li><a href="#introduction-8">Introduction</a></li>
<li><a href="#installing">Installing</a></li>
<li><a href="#odo-command-set">odo command set</a></li>
<li><a href="#logging-in">Logging in</a>
<ul class="sectlevel3">
<li><a href="#download-source-assets">Download source assets</a></li>
</ul>
</li>
<li><a href="#create-push-source-run-cycle">Create, push source &amp; run cycle</a></li>
<li><a href="#odo-watch">odo watch</a></li>
</ul>
</li>
<li><a href="#openshift-pipelines-tekton">OpenShift Pipelines - Tekton</a>
<ul class="sectlevel2">
<li><a href="#introduction-9">Introduction</a></li>
<li><a href="#create-a-project">Create a project</a></li>
<li><a href="#tasks">Tasks</a>
<ul class="sectlevel3">
<li><a href="#download-pipeline-assets">Download pipeline assets</a></li>
<li><a href="#simple-task-creation-and-execution">Simple task creation and execution</a></li>
</ul>
</li>
<li><a href="#pipelines">Pipelines</a></li>
<li><a href="#viewing-pipelines-through-the-web-ui">Viewing pipelines through the Web UI</a></li>
<li><a href="#task-inputs">Task inputs</a>
<ul class="sectlevel3">
<li><a href="#task-input-example">Task input example</a></li>
</ul>
</li>
<li><a href="#workspaces-and-volumes">Workspaces and Volumes</a></li>
</ul>
</li>
<li><a href="#camel-k-on-openshift">Camel K on Openshift</a>
<ul class="sectlevel2">
<li><a href="#introduction-10">Introduction</a></li>
<li><a href="#create-a-new-project">Create a new project</a></li>
<li><a href="#camel-k-and-the-operator-lifecycle-manager">Camel K and the Operator Lifecycle Manager</a></li>
<li><a href="#download-and-configure-your-environment">Download and configure your environment</a></li>
<li><a href="#deploy-a-camel-k-interation">Deploy a Camel K Interation</a></li>
<li><a href="#deploy-camel-k-in-developer-mode">Deploy Camel K in Developer mode</a></li>
<li><a href="#optional-labs">Optional labs</a></li>
</ul>
</li>
<li><a href="#camel-k-and-openshift-serverless">Camel K and Openshift Serverless</a>
<ul class="sectlevel2">
<li><a href="#introduction-11">Introduction</a></li>
<li><a href="#create-a-new-project-2">Create a new project</a></li>
<li><a href="#openshift-serverless-and-the-operator-lifecycle-manager">Openshift Serverless and the Operator Lifecycle Manager</a></li>
<li><a href="#install-openshift-serverless">Install Openshift Serverless</a></li>
<li><a href="#download-and-configure-your-environment-2">Download and configure your environment</a></li>
<li><a href="#create-knative-messaging-channel">Create Knative Messaging Channel</a></li>
<li><a href="#deploy-the-integrations">Deploy the Integrations</a></li>
<li><a href="#knative-in-action">Knative in action</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="intro"><a class="anchor" href="#intro"></a>Introduction</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="attendee-details"><a class="anchor" href="#attendee-details"></a>Attendee details</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-bottom"><div class="content"><div class="paragraph">
<p>Name:</p>
</div></div></td>
<td class="tableblock halign-left valign-bottom"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-bottom"><div class="content"><div class="paragraph">
<p>User ID (userX):</p>
</div></div></td>
<td class="tableblock halign-left valign-bottom"><div class="content"></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>This workshop is designed to introduce Developers to <strong>OpenShift 4</strong> and explain the usage and technologies around it from a developer perspective.</p>
</div>
<div class="sect3">
<h4 id="what-is-openshift"><a class="anchor" href="#what-is-openshift"></a>What is Openshift</h4>
<div class="paragraph">
<p>Red Hat® OpenShift® is a hybrid cloud, enterprise, secure Kubernetes application platform.</p>
</div>
<div class="paragraph">
<p>OpenShift is a family of containerization software developed by Red Hat.
Its flagship product is the OpenShift Container Platform—an on-premises platform as a service built around OCI standard containers orchestrated and
managed by Kubernetes on a foundation of Red Hat Enterprise Linux.</p>
</div>
</div>
<div class="sect3">
<h4 id="links"><a class="anchor" href="#links"></a>Links</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.openshift.com/learn/what-is-openshift">https://www.openshift.com/learn/what-is-openshift</a></p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/OpenShift">https://en.wikipedia.org/wiki/OpenShift</a></p>
</li>
<li>
<p><a href="https://www.openshift.com/products/container-platform">https://www.openshift.com/products/container-platform</a></p>
</li>
<li>
<p><a href="http://console-openshift-console.apps.cluster-devex1-37b5.devex1-37b5.example.opentlc.com" class="bare">http://console-openshift-console.apps.cluster-devex1-37b5.devex1-37b5.example.opentlc.com</a> (the Web Console URL for the Workshop)</p>
</li>
<li>
<p><a href="https://terminal-terminal.apps.cluster-devex1-37b5.devex1-37b5.example.opentlc.com/" class="bare">https://terminal-terminal.apps.cluster-devex1-37b5.devex1-37b5.example.opentlc.com/</a> (The Web Terminal URL for the workshop)</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="contributors"><a class="anchor" href="#contributors"></a>Contributors</h4>
<div class="paragraph">
<p>Red Hat UK DSA Team:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Phil Prosser</p>
</li>
<li>
<p>Mark Roberts</p>
</li>
<li>
<p>''Uther'' Lawson</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Original asciidoc project for DevEx3.x by Phillip Kruger, Red Hat CEMEA</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="application-basics"><a class="anchor" href="#application-basics"></a>Application Basics</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="introduction"><a class="anchor" href="#introduction"></a>Introduction</h3>
<div class="paragraph">
<p>This chapter will introduce the attendee to the mechanics of creating and manipulating Applications using OpenShift Container Platform. It will introduce the two distinct contexts of the User Interface, the Administrator and Developer views, and guide the attendee through creating some Applications.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The attendee will be using a browser for interacting with both the OpenShift Container Platform UI and the provided terminal (for command line exercises). It is suggested the attendee uses Chrome or Firefox.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="starting-up-logging-on-and-creating-a-project"><a class="anchor" href="#starting-up-logging-on-and-creating-a-project"></a>Starting up - logging on and creating a project</h3>
<div class="paragraph">
<p>Log on to cluster at <a href="http://console-openshift-console.apps.cluster-devex1-37b5.devex1-37b5.example.opentlc.com">http://console-openshift-console.apps.cluster-devex1-37b5.devex1-37b5.example.opentlc.com</a> as 'userx', where x is the number assigned to you by the course administrator, password 'openshift'</p>
</div>
<div class="paragraph">
<p>Ensure you are on the Administrator View (top level, select Administrator)</p>
</div>
<div class="paragraph">
<p><strong>The Administrator view provides you with an extended functionality interface that allows you to deep dive into the objects available to your user. The Developer view is an opinionated interface designed to ease the use of the system for developers. This workshop will have you swapping between the contexts for different tasks.</strong></p>
</div>
<div class="paragraph">
<p>Click on 'Create Project'</p>
</div>
<div class="paragraph">
<p>Name - ‘sandboxX’ where x is user number</p>
</div>
<div class="paragraph">
<p>Display Name, Description are labels</p>
</div>
<div class="paragraph">
<p>When created click on 'Role Bindings'</p>
</div>
<div class="paragraph">
<p><strong>By default when you create a Project within OpenShift your user is given administration rights. This allows the user
to create any objects that they have rights to create and to change the security and access settings for the project
itself, i.e. add users as Administrators, Edit Access, Read access or disable other user&#8217;s abilities to even see
the project and the objects within.</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="creating-your-first-application"><a class="anchor" href="#creating-your-first-application"></a>Creating your first Application</h3>
<div class="paragraph">
<p>In the top left of the UI, where the label indicates the view mode, change the mode from Administrator to Developer</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/applicationbasics-2.png" alt="Developer Context">
</div>
</div>
<div class="paragraph">
<p>Click 'Add'</p>
</div>
<div class="paragraph">
<p><strong>The Catalog screen for the developer combines all the ways components can be added into the Project. These are:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>From Git - this provides another way to do a Source-2-Image build by first choosing the Git repo and then the builder image to use</strong></p>
</li>
<li>
<p><strong>Container Image - this provides a way to directly deploy an Image from a repository</strong></p>
</li>
<li>
<p><strong>From Catalog - this allows the Developer to browse all available templates, which are predefined sets of Objects to create an application</strong></p>
</li>
<li>
<p><strong>From Dockerfile - this allows the Developer to do a controlled build of an Image from a Dockerfile</strong></p>
</li>
<li>
<p><strong>YAML - this allows the Developer to provide a set of populated YAML to define the objects to be added to the Project</strong></p>
</li>
<li>
<p><strong>Database - this allows the Developer to browse pre-created Database services to add to the Project</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Select ‘From Catalog’</p>
</div>
<div class="paragraph">
<p>Enter ‘node’ in the search box</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/applicationbasics-1.png" alt="Node Choice">
</div>
</div>
<div class="paragraph">
<p><strong>OpenShift allows for multiple base images to be built upon - the selection of node searches for any images or templates registered into the system
with the label 'node'. In the screenshot above, and in the catalog you will be presented with, there will be a selection of base images.</strong></p>
</div>
<div class="paragraph">
<p>Select ‘Node.js’</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/applicationbasics-3.png" alt="Node Choice">
</div>
</div>
<div class="paragraph">
<p><strong>When you select an option, in this case the Node.js builder one, you are presented with a wizard that shows you exactly what
components will be created as part of your Project. In this case, with Node.js, the template will create a build config, that will build the
Image that will contain your Application, an ImageStream which is the OpenShift representation of an Image, a deployment config, which defines exactly how the image
will be deployed as a running Container within the Project, a service which is the internal endpoint for the application within the Project and a route,
optionally, which will provide access to the Application for external consumers.</strong></p>
</div>
<div class="paragraph">
<p>Click on 'Create Application'</p>
</div>
<div class="paragraph">
<p><strong>This approach uses the OpenShift ''source-2-image'' concept, which is a controlled mechanism provided by OpenShift that automates the creation
of application images using a base image and a source repository.</strong></p>
</div>
<div class="paragraph">
<p>Change the Builder Image Version to 8</p>
</div>
<div class="paragraph">
<p><strong>The ''source-2-image'' approach allows you to use differing versions of a base image - in this case you can execute the Node build against a number of supported Node
versions.</strong></p>
</div>
<div class="paragraph">
<p>Git repo - <a href="https://github.com/utherp0/nodenews">https://github.com/utherp0/nodenews</a></p>
</div>
<div class="paragraph">
<p>In a separate browser tab go to <a href="https://github.com/utherp0/nodenews">https://github.com/utherp0/nodenews</a></p>
</div>
<div class="paragraph">
<p><strong>If you visit the URL you will see there is no OpenShift specific code in the repository at all.</strong></p>
</div>
<div class="paragraph">
<p>Close the github tab</p>
</div>
<div class="paragraph">
<p>Back at the OCP4.2 Ux leave the Application as ‘Create Application’.</p>
</div>
<div class="paragraph">
<p><strong>OpenShift 4 introduces the concept of Application Grouping. This allows a visualisation of multiple Applications in the same 'group', making visibility of the Application much
simpler.</strong></p>
</div>
<div class="paragraph">
<p>Ensure the application name is ‘nodenews-app’</p>
</div>
<div class="paragraph">
<p>Ensure the Name is ‘nodenews’</p>
</div>
<div class="paragraph">
<p>Ensure the ‘Create Route is checked’</p>
</div>
<div class="paragraph">
<p>Click 'Create'</p>
</div>
<div class="paragraph">
<p><strong>The Topology view is a new feature of OpenShift 4 that provides a dynamic and useful visualisation of all of your Applications in a given Project.</strong></p>
</div>
<div class="paragraph">
<p>Click on the Icon marked 'Node'</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/applicationbasics-4.png" alt="Node Sidepanel">
</div>
</div>
<div class="paragraph">
<p><strong>The side-panel contains an overview of the Application you chose. In this case it will cover
the build. Once a build has completed this side panel shows the Pods that are running, the builds that have completed, the services
exported for the Application and the routes, if the Application has any.</strong></p>
</div>
<div class="paragraph">
<p>Wait for the Build to finish, the Pod to change from Container Creating to Running</p>
</div>
<div class="paragraph">
<p><strong>When an Application is created the Pod ring will be empty, indicating that an Application will appear once the build has completed. When the build
completes the Pod ring will switch to light blue, indicating the Pod is being pulled (the image is being pulled from the registry to the Node where the
Pod will land) and is starting (the Pod is physically in place but the Containers within it are not reporting as ready). Once the Pod is placed and running the colour
of the Pod ring will change to dark blue.</strong></p>
</div>
<div class="paragraph">
<p>Click on the Tick at the bottom left of the Pod</p>
</div>
<div class="paragraph">
<p><strong>If you scroll the log of the Build output you will see the steps that the build takes. This includes laying the foundational file layers for the base
image, performing the code specific build operations (in this case an ''npm install'') and then pushing the file layers for the image into the OpenShift
integrated registry.</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="adding-additional-applications"><a class="anchor" href="#adding-additional-applications"></a>Adding additional Applications</h3>
<div class="paragraph">
<p>Click on 'Topology'</p>
</div>
<div class="paragraph">
<p>Click 'Add'</p>
</div>
<div class="paragraph">
<p>Click 'From Catalog'</p>
</div>
<div class="paragraph">
<p>Search for ‘httpd’</p>
</div>
<div class="paragraph">
<p>Select the (httpd) template</p>
</div>
<div class="paragraph">
<p>Click on 'Create Application'</p>
</div>
<div class="paragraph">
<p>Leave Image Version as 2.4</p>
</div>
<div class="paragraph">
<p>Set the git repo to ‘https://github.com/utherp0/forumstaticassets’</p>
</div>
<div class="paragraph">
<p>Ensure the Application is ‘nodenews-app’</p>
</div>
<div class="paragraph">
<p>Ensure the name is forumstaticassets</p>
</div>
<div class="paragraph">
<p>Ensure the ‘Create a Route’ checkbox is clicked</p>
</div>
<div class="paragraph">
<p>Click 'Create'</p>
</div>
<div class="paragraph">
<p><strong>Note that the new Application icon appears within a bounded area on the Topology page labelled with the 'Application' chosen above. If you click on the area between the Pods you can move
the group as a single action.</strong></p>
</div>
<div class="paragraph">
<p>Click on the forumstaticassets Pod</p>
</div>
<div class="paragraph">
<p>Watch the build complete, the Container Creating and the Running event</p>
</div>
<div class="paragraph">
<p>Click 'Add'</p>
</div>
<div class="paragraph">
<p>Click 'From Catalog'</p>
</div>
<div class="paragraph">
<p>Search for ‘node’</p>
</div>
<div class="paragraph">
<p>Select ‘Node.js’</p>
</div>
<div class="paragraph">
<p>Click 'Create Application'</p>
</div>
<div class="paragraph">
<p>Leave at Builder Image Version 10</p>
</div>
<div class="paragraph">
<p>Set the git repo to ‘https://github.com/utherp0/ocpnode’</p>
</div>
<div class="paragraph">
<p>In the ‘Application’ pulldown select ‘Create Application</p>
</div>
<div class="paragraph">
<p>In the ‘Application Name’ enter ‘ocpnode-app’</p>
</div>
<div class="paragraph">
<p>Ensure the Name is ‘ocpnode’</p>
</div>
<div class="paragraph">
<p>Ensure the ‘Create Route’ is checked</p>
</div>
<div class="paragraph">
<p>Click 'Create'</p>
</div>
<div class="paragraph">
<p>Click on the ‘ocpnode’ Application in the topology - click on the ‘cross’ icon to centralise the topology</p>
</div>
<div class="paragraph">
<p><strong>Now we have created a new Application grouping you will see two ''cloud'' groupings, labelled with the appropriate Application name you entered.</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="interacting-with-openshift-through-the-command-line"><a class="anchor" href="#interacting-with-openshift-through-the-command-line"></a>Interacting with OpenShift through the Command Line</h3>
<div class="paragraph">
<p>With the OpenShift Enterprise command line interface (CLI), you can create applications and manage OpenShift projects from a terminal.
The CLI is ideal in situations where you are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Working directly with project source code.</p>
</li>
<li>
<p>Scripting OpenShift Enterprise operations.</p>
</li>
<li>
<p>Restricted by bandwidth resources and cannot use the web console.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The CLI is available using the oc command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">oc {command}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For the duration of the course you will be using a provided Application hosted within OpenShift itself - this is reachable at <a href="https://terminal-terminal.apps.cluster-devex1-37b5.devex1-37b5.example.opentlc.com/">https://terminal-terminal.apps.cluster-devex1-37b5.devex1-37b5.example.opentlc.com/</a></p>
</div>
<div class="paragraph">
<p>If you want to install the oc client or use the terminal applications plus additional command line tools, such as ODO and tkn, you have two options; either install <code>oc</code> on your localhost or use a docker image in OpenShift. The image option is pre-built and running already and is easier if you have a locked-down laptop and are unable to download and install additional applications.</p>
</div>
<div class="sect3">
<h4 id="option-1-installing-the-cli-on-localhost"><a class="anchor" href="#option-1-installing-the-cli-on-localhost"></a>Option 1: Installing the CLI on localhost</h4>
<div class="paragraph">
<p>The easiest way to download the CLI is by accessing the Command Line Tools page on the web console from the question mark on teh top right corner [ (?)&#8594; Command Line Tools ]</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/applicationbasics-5.png" alt="Command Line Tools">
</div>
</div>
<div class="paragraph">
<p>From this page you can download the oc and odo command line tools.</p>
</div>
<div class="paragraph">
<p>If you wish to install the command line tools locally then you may also need to download and command line tools for OpenShift Pipelines (Tekton) and Kamel. Instructions on this is at the start of each chapter.</p>
</div>
</div>
<div class="sect3">
<h4 id="option-2-use-a-pre-configured-docker-image-on-openshift"><a class="anchor" href="#option-2-use-a-pre-configured-docker-image-on-openshift"></a>Option 2: Use a pre-configured docker image on OpenShift</h4>
<div class="paragraph">
<p>This option installs and runs a docker image inside OpenShift that already has oc (and other command line tools) installed and configured. To install this image, do the following:</p>
</div>
<div class="paragraph">
<p>Login to the OCP system through the UI. (userX / openshift)
Ensure that you are in the Developer mode of the user interface by selecting Developer in the top left corner menu. Select the project drop down menu and select Create Project.
Create a new project:
Name: oconline-userX
Display Name: OC Terminal</p>
</div>
<div class="paragraph">
<p>You will then see a Topology view that allows you to create new workloads from a variety of sources as shown below:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/applicationbasics-6.png" alt="Topology view">
</div>
</div>
<div class="paragraph">
<p>Select container image and paste into the image name :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">quay.io/marrober/devex-terminal-4</code></pre>
</div>
</div>
<div class="paragraph">
<p>Press the search button on the end of the line to force the application to examine the repository image.</p>
</div>
<div class="paragraph">
<p>For the Application name enter : DevEx-Terminal
For the Name : enter DevEx-Terminal
Ensure the box is ticked for 'Create a route to the application'</p>
</div>
<div class="paragraph">
<p>Click create.</p>
</div>
<div class="paragraph">
<p>Wait for the pod to spin up and show a dark blue ring on the topology view.</p>
</div>
<div class="paragraph">
<p>Click on the pod and on then on the resources tab on the right hand side click on the route. This will launch the terminal in a new browser window.</p>
</div>
<div class="paragraph">
<p>Keep this terminal window open for the remainder of the workshop for all of your command line interaction.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="setup-login"><a class="anchor" href="#setup-login"></a>Using your terminal (Both options)</h3>
<div class="paragraph">
<p>If this document refer to <em>your terminal</em> it will either be on your localhost or the containerised terminal depending your option above.</p>
</div>
<div class="paragraph">
<p>(Login options for the installed OC command line tool only).
* In the Web Console, select the top right pulldown, choose <b class="button">Copy Login Command</b>
* This will require you to login again using your credentials (to prove who you are) and will then display a web page with 'Display Token' on it. Select this link and copy the full likne that behind with oc login --token&#8230;&#8203;&#8230;&#8203;
* Paste this into the command line window on your local machine where you have access to run the oc command. Note that oc must be added to your path.</p>
</div>
<div class="paragraph">
<p>The response to executing the login command should look similar to that shown below :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">Logged into "https://api.cluster-london-a6e1.london-a6e1.example.opentlc.com:6443" as "user1" using the token provided.

You don't have any projects. You can try to create a new project, by running

    oc new-project &lt;projectname&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Make sure <code>oc</code> is working, type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">oc whoami
oc version</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Also see the <strong>Command-Line Reference</strong>: <a href="https://docs.openshift.com/container-platform/4.2/cli_reference/openshift_cli/getting-started-cli.html">https://docs.openshift.com/container-platform/4.2/cli_reference/openshift_cli/getting-started-cli.html</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To explore the command line further execute the following commands and observe the results.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">oc projects</code></pre>
</div>
</div>
<div class="paragraph">
<p>User should have access to one project, explain the ability to access multiple projects</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">oc project sandboxX</code></pre>
</div>
</div>
<div class="paragraph">
<p>User should now be using the sandboxX project created and configured earlier</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">oc get users</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>There is a level of permission within the OpenShift system called ''Cluster Admin''. This permission allows a User to access any of the objects on the
system regardless of Project. It is effectively a super-user and as such normal users do not normally have this level of access.</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">oc get pods</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>If you look carefully at the Pods shown you will notice there are additional Pods above and beyond the ones expected for your Applications. If you look at the state of
these Pods they will be marked as Completed. Everything in OpenShift is executed as a Pod, including Builds. These completed Pods are the Builds we have run so far.</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">oc get pods | grep Completed</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">oc get pods | grep Running</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">oc get dc</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>DC is an abbreviation for Deployment Config. These are Objects that directly define how an Application is deployed within OpenShift. This is the ''ops''
side of the OpenShift system. Deployment Configs are different to Kubernetes Deployments in that they are an extension and contain things such as Config Maps, Secrets,
Volume Mounts, labelled targetting of Nodes and the like.</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">oc scale dc/nodenews --replicas=2</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="a-summary-of-application-interactions"><a class="anchor" href="#a-summary-of-application-interactions"></a>A Summary of Application Interactions</h3>
<div class="paragraph">
<p>Go back to the UI and make sure you are on Developer mode. Click on Topology.</p>
</div>
<div class="paragraph">
<p>Click on the ‘nodenews’ application</p>
</div>
<div class="paragraph">
<p>Note the ‘DC’ reference to the application under the icon</p>
</div>
<div class="paragraph">
<p>In the pop-up panel on the right click on 'Resources'</p>
</div>
<div class="paragraph">
<p>Note that there are two pods running with the application now</p>
</div>
<div class="paragraph">
<p>Change the mode from Developer to Administrator</p>
</div>
<div class="paragraph">
<p>Select the 'sandboxx' project in the project list</p>
</div>
<div class="paragraph">
<p>Note the metrics for the project</p>
</div>
<div class="paragraph">
<p>Click on 'Workloads' and then select Pods.</p>
</div>
<div class="paragraph">
<p>Change to Developer mode and then select Topology if the Topology page isn’t already shown</p>
</div>
<div class="paragraph">
<p>Click and hold on the forumstaticassets Pod and drag it onto the ocpnode-app</p>
</div>
<div class="paragraph">
<p>Select ‘move’ when it prompts whether you want to move it</p>
</div>
<div class="paragraph">
<p><strong>This concept of Application grouping allows for much better visualisation of the complete application.</strong></p>
</div>
<div class="paragraph">
<p>Continue on with the Deployments chapter, which uses the applications created here to show the capabilities of the deployment configuration and how to alter the behaviour and file system of a Container without changing the image.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="understanding-deployments-and-configuration"><a class="anchor" href="#understanding-deployments-and-configuration"></a>Understanding Deployments and Configuration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="introduction-2"><a class="anchor" href="#introduction-2"></a>Introduction</h3>
<div class="paragraph">
<p>This chapter will introduce the attendee to concepts of deployments and configuration injection using OpenShift Container Platform.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The attendee will be using a browser for interacting with both the OpenShift Container Platform UI and the provided terminal (for command line exercises). It is suggested the attendee uses Chrome or Firefox.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This chapter follows directly on from the Application Basics one so it is assumed the attendee is logged on to the system and has the applications pre-created. If you are starting at this chapter please repeat the commands from the Application Basics chapter. You should start this chapter with two application running in the project, nodenews and ocpnode
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="introducing-deployment-configurations"><a class="anchor" href="#introducing-deployment-configurations"></a>Introducing Deployment Configurations</h3>
<div class="paragraph">
<p>Ensure you are on the Administrator View (top level, select 'Administrator')
Select 'Workloads/Deployment Configs'</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/deployment-1.png" alt="Deployment Configs">
</div>
</div>
<div class="paragraph">
<p><strong>Observe the information provided on the Deployment Configs screen. DC indicates the Deployment Config by name, NS is the project/namespace, Labels are the OpenShift labels applied to the DC for collating and visualisation, status indicates the active Pod count for the Deployment and pod selector indicates the labels used for the Pods attributed to the Deployment Config.</strong></p>
</div>
<div class="paragraph">
<p>Click on the 'nodenews' deployment-config</p>
</div>
<div class="paragraph">
<p>Next to the Pod icon, with the count in it which should be set to two, click on the up arrow twice</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/deployment-2.png" alt="Scaling the Deployment">
</div>
</div>
<div class="paragraph">
<p><strong>We have told the deployment config to run four replicas. The system now updated the replication controller, whose job is to make sure that x replicas are running healthily, and once the replication controller is updated the system will ensure that number of replicas is running</strong></p>
</div>
<div class="paragraph">
<p>Click on ‘YAML’</p>
</div>
<div class="paragraph">
<p>In the YAML find an entry for replicas. It should say 4. Set it to 2, then save.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/deployment-3.png" alt="Editing the DC YAML">
</div>
</div>
<div class="paragraph">
<p>Click on ‘Deployment Configs’ near the top of the panel.</p>
</div>
<div class="paragraph">
<p>Select the nodenews deployment config by clicking on the nodenews DC link</p>
</div>
<div class="paragraph">
<p>Ensure the Pod count is now two</p>
</div>
</div>
<div class="sect2">
<h3 id="dependency-injection-using-config-maps"><a class="anchor" href="#dependency-injection-using-config-maps"></a>Dependency Injection using Config Maps</h3>
<div class="paragraph">
<p>Click on 'Workloads/Config Maps'</p>
</div>
<div class="paragraph">
<p><strong>Config Maps allow you to create groups of name/value pairs in objects that can be expressed into the Applications via the Deployment Configs and can change the file system, environment and behaviour of the Application without having to change the 'image' from whence the Application was created. This is extremely useful for dependency injection without having to rebuild the Application image</strong></p>
</div>
<div class="paragraph">
<p>Click on ‘Create Config Map’</p>
</div>
<div class="paragraph">
<p>In the editor change the name: from example to ‘nodenewsconfig’</p>
</div>
<div class="paragraph">
<p>Delete all of the lines below data:</p>
</div>
<div class="paragraph">
<p>Add “  env1: test”</p>
</div>
<div class="paragraph">
<p>Add “  env2:test2”</p>
</div>
<div class="paragraph">
<p>The YAML should look similar to the screenshot below, with your project name instead of sandbox99 and the name you have entered rather than CHANGETHIS.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/deployment-4.png" alt="Example Config Map YAML">
</div>
</div>
<div class="paragraph">
<p>Press 'Create'</p>
</div>
<div class="paragraph">
<p>Go back to the command line tab at <a href="https://terminal-terminal.apps.cluster-devex1-37b5.devex1-37b5.example.opentlc.com/">https://terminal-terminal.apps.cluster-devex1-37b5.devex1-37b5.example.opentlc.com/</a></p>
</div>
<div class="paragraph">
<p>Type ‘oc get configmaps’</p>
</div>
<div class="paragraph">
<p>Type ‘oc describe configmap nodenewsconfig’</p>
</div>
<div class="paragraph">
<p>Go back to UI, select 'Workloads/Deployment Configs'</p>
</div>
<div class="paragraph">
<p>Click on the 'nodenews' dc</p>
</div>
<div class="paragraph">
<p>Click on 'Environment'</p>
</div>
<div class="paragraph">
<p>In ‘All Values from existing config maps’ select nodenewsconfig from the pulldown on the left and add nodenewsconfig as the prefix</p>
</div>
<div class="paragraph">
<p>Click 'Save'</p>
</div>
<div class="paragraph">
<p>Click on 'Workloads/Pods' - if you are quick enough you will see the nodenews Pods being redeployed</p>
</div>
<div class="paragraph">
<p><strong>By default when you create a Deployment Config in OpenShift, as part of an Application or as a standalone object via YAML, the Deployment Config will have two distinct triggers for automation. These make the Deployment redeploy when a: the image that the Deployment Config is based on changes in the registry or b: the defined configuration of the Deploument changes via a change to the DC object itself</strong></p>
</div>
<div class="paragraph">
<p><strong>These are default behaviours but can be overridden. They are designed to make sure that the current deployment exactly matches the Images and the definition of the deployment by default.</strong></p>
</div>
<div class="paragraph">
<p>Click on one of the Pods for 'nodenews'</p>
</div>
<div class="paragraph">
<p>In the Pod Details page click on 'Terminal'</p>
</div>
<div class="paragraph">
<p>In the terminal type ‘env | grep nodenewsconfig’</p>
</div>
<div class="paragraph">
<p><strong>Note that the env variables from the config map have been expressed within the Pod as env variables (with the nodenewsconfig prefixed)</strong></p>
</div>
<div class="paragraph">
<p>Go back to the command line tab at <a href="https://terminal-terminal.apps.cluster-devex1-37b5.devex1-37b5.example.opentlc.com/" class="bare">https://terminal-terminal.apps.cluster-devex1-37b5.devex1-37b5.example.opentlc.com/</a> and enter the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">mkdir material
cd material
git clone https://github.com/utherp0/workshop4
cd workshop4/attendee
cat testfile.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>All objects in Kubernetes/Openshift can be expressed as yaml and this is a basic configmap for a file. What is very nice about the API and it&#8217;s object oriented nature is that you can export any object that you have the RBAC rights to view and import them directly back into OpenShift, which is what we will do now with the following commands in the terminal</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">oc create -f testfile.yaml
oc get configmaps</code></pre>
</div>
</div>
<div class="paragraph">
<p>Go back to the UI, select 'Workloads/Deployment Configs'</p>
</div>
<div class="paragraph">
<p>Select 'nodenews' dc</p>
</div>
<div class="paragraph">
<p>Click on 'YAML'</p>
</div>
<div class="paragraph">
<p>In order to add the config-map as a volume we need to change the container specification within the deployment config.</p>
</div>
<div class="paragraph">
<p>Find the setting for ‘imagePullPolicy’. Put the cursor to the end of the line. Hit return. Underneath enter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">        volumeMounts:
           - name: workshop-testfile
             mountPath: /workshop/config</code></pre>
</div>
</div>
<div class="paragraph">
<p>Make sure the indentation is the same as for the ‘imagePullPolicy’.</p>
</div>
<div class="paragraph">
<p>Now in the ‘spec:’ portion we need to add our config-map as a volume.</p>
</div>
<div class="paragraph">
<p>Find ‘restartPolicy’. Put the cursor to the end of the line and press return. Underneath enter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">     volumes:
       - name: workshop-testfile
         configMap:
           name: testfile
           defaultMode: 420</code></pre>
</div>
</div>
<div class="paragraph">
<p>Save the deployment config.</p>
</div>
<div class="paragraph">
<p>Click on 'Workloads/Pods'. Watch the new versions of the nodenews application deploy.</p>
</div>
<div class="paragraph">
<p>When they finish deploying click on one of the Pods. Click on 'Terminal'.</p>
</div>
<div class="paragraph">
<p>In the terminal type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">cd /workshop
ls
cd config</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note that we have a new file called ‘app.conf’ in this directory. This file is NOT part of the image that generated the container.</strong></p>
</div>
<div class="paragraph">
<p>In the terminal type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">cat app.conf</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>This is the value from the configmap object expressed as a file into the running container.</strong></p>
</div>
<div class="paragraph">
<p>In the terminal type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">vi app.conf</code></pre>
</div>
</div>
<div class="paragraph">
<p>Press ‘i’ to insert, then type anything. Then press ESC. Then type ‘:wq’</p>
</div>
<div class="paragraph">
<p><strong>You will not be able to save it. The file expressed into the Container from the configmap is ALWAYS readonly which ensures
any information provided via the config map is controlled and immutable.</strong></p>
</div>
<div class="paragraph">
<p>Type ‘:q!’ to quit out of the editor</p>
</div>
</div>
<div class="sect2">
<h3 id="dependency-injection-of-sensitive-information-using-secrets"><a class="anchor" href="#dependency-injection-of-sensitive-information-using-secrets"></a>Dependency Injection of sensitive information using Secrets</h3>
<div class="paragraph">
<p><strong>The config map to be written as a gile is actually written to the Container Hosts as a file, and then expressed into the running Container as a symbolic link. This is good but can be seen as somewhat insecure because the file is stored 'as-is' on the Container Hosts, where the Containers are executed</strong></p>
</div>
<div class="paragraph">
<p><strong>For secure information, such as passwords, connection strings and the like, OpenShift has the concept of 'Secrets'. These act like config maps 'but' importantly the contents of the secrets are encrypted at creation, encrypted at storage when written to the Container Hosts and then unencrypted only when expressed into the Container, meaning only the running Container can see the value of the secret.</strong></p>
</div>
<div class="paragraph">
<p>In the UI select 'Workloads/Secrets'</p>
</div>
<div class="paragraph">
<p>Click on 'Create'</p>
</div>
<div class="paragraph">
<p>Choose ‘Key/Value Secret'</p>
</div>
<div class="paragraph">
<p>For ‘Secret Name’ give ‘nodenewssecret’</p>
</div>
<div class="paragraph">
<p>Set ‘Key’ to ‘password’</p>
</div>
<div class="paragraph">
<p>Set ‘Value’ textbox to ‘mypassword’</p>
</div>
<div class="paragraph">
<p>Click ‘Create’</p>
</div>
<div class="paragraph">
<p>When created click on the ‘YAML’ box in the Secrets/Secret Details overview</p>
</div>
<div class="paragraph">
<p><strong>Note that the type is ‘Opaque’ and the data is encrypted</strong></p>
</div>
<div class="paragraph">
<p>Click on ‘Add Secret To Workload’</p>
</div>
<div class="paragraph">
<p>In the ‘Select a workload’ pulldown select the nodenews DC</p>
</div>
<div class="paragraph">
<p>Ensure the ‘Add Secret As’ is set to Environment Variables</p>
</div>
<div class="paragraph">
<p>Add the Prefix ‘secret’</p>
</div>
<div class="paragraph">
<p>Click ‘Save’</p>
</div>
<div class="paragraph">
<p>Watch the Pods update on the subsequent ‘DC Nodenews’ overview</p>
</div>
<div class="paragraph">
<p>When they have completed click on ‘Pods’</p>
</div>
<div class="paragraph">
<p>Choose one of the nodenews running pods, click on it, choose Terminal</p>
</div>
<div class="paragraph">
<p>In the terminal type ‘env | grep secret’</p>
</div>
</div>
<div class="sect2">
<h3 id="understanding-the-deployment-strategies"><a class="anchor" href="#understanding-the-deployment-strategies"></a>Understanding the Deployment Strategies</h3>
<div class="paragraph">
<p>Click on 'Workloads/Deployment Configs'</p>
</div>
<div class="paragraph">
<p>Click on the DC for 'nodenews'</p>
</div>
<div class="paragraph">
<p>Scale the Application up to four copies using the up arrow next to the Pod count indicator</p>
</div>
<div class="paragraph">
<p>Once the count has gone to 4 and all the Pods are indicated as healthy (the colour of the Pod ring is blue for all Pods) select Action/Start Rollout.</p>
</div>
<div class="paragraph">
<p>Ignore the 404 (race condition) - click Back on the browser to go to the deployment config again</p>
</div>
<div class="paragraph">
<p>Watch the colours of the Pods</p>
</div>
<div class="paragraph">
<p><strong>Deployments can have one of two strategies. This example uses the 'Rolling' strategy which is designed for zero downtime deployments. It works but spinning up a single copy of the new Pod, and when that Pod reports as being healthy only then is one of the old Pods removed. This insures that at all times the required number of replicas are running healthy with no downtime for the Application itself.</strong></p>
</div>
<div class="paragraph">
<p>Click on 'Workloads/Deployment Configs', click on the nodenews DC again</p>
</div>
<div class="paragraph">
<p>Click on 'Actions/Edit Deployment Config'</p>
</div>
<div class="paragraph">
<p>Scroll the editor down to the ‘spec:’ tag as shown below</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">spec:
 strategy:
   type: Rolling
   rollingParams:</code></pre>
</div>
</div>
<div class="paragraph">
<p>Change the type: tag of the strategy to Recreate as shown below</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">spec:
 strategy:
   type: Recreate</code></pre>
</div>
</div>
<div class="paragraph">
<p>Click on 'Save'</p>
</div>
<div class="paragraph">
<p>Click on 'Workloads/Deployment Configs', select nodenews dc</p>
</div>
<div class="paragraph">
<p>Click on ‘Action/Start Rollout’</p>
</div>
<div class="paragraph">
<p>Click back on the browser to go to the Deployment Configs/nodenews overview</p>
</div>
<div class="paragraph">
<p>Watch the colour of the Pod ring</p>
</div>
<div class="paragraph">
<p><strong>In the case of a Recreate strategy the system insures that NO copies of the old deployment are running simultaneously with the new ones. It deletes all the running Pods, irregardless of the required number of replicas, and when all Pods report as being fully deleted it will start spinning up the new copies. This is for a scenario when you must NOT have any users interacting with the old Application once the new one is deployed, such as a security flaw in the old Application</strong></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="application-deployment-configurations-and-devops-approaches"><a class="anchor" href="#application-deployment-configurations-and-devops-approaches"></a>Application Deployment Configurations and DevOps Approaches</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="introduction-3"><a class="anchor" href="#introduction-3"></a>Introduction</h3>
<div class="paragraph">
<p><strong>DevOps is a much overloaded term that is used to describe a variety of concepts in the creation of modern applications. In a simple definition DevOps is concerned with the interface between development practices used for the creative elements of software engineering and the procedural rigour of operationally running applications in production. Clearly these concepts have different objectives so it is important for teams (whether tasked with development or operations) to have a good understanding of the concepts, objectives and concerns of their counterparts on the other side of the fence.</strong></p>
</div>
<div class="paragraph">
<p><strong>In terms of this workshop it is important to highlight the  capabilities of containerised platforms with respect to the roll out of new versions of applications and how they get introduced to production and to end users. Terms such as blue/green deployments, black and white deployments, A/B deployments and canary deployments are used in various text books on 'DevOps' principles and some of these areas will be used in this chapter of the workshop.</strong></p>
</div>
<div class="paragraph">
<p><strong>The activities in this workshop will introduce a new version of a simple application to use in two different manners.</strong></p>
</div>
<div class="sect3">
<h4 id="workshop-content"><a class="anchor" href="#workshop-content"></a>Workshop Content</h4>
<div class="paragraph">
<p><strong>The application to be used in this workshop is a simple NodeJS REST interface. Version 1 exists on the master branch of the GIT Repository and verison 2 exists on the experimental branch.</strong></p>
</div>
<div class="paragraph">
<p><strong>To begin the creation of the application use the following commands in an command line window. :</strong></p>
</div>
</div>
<div class="sect3">
<h4 id="creation-of-version-1"><a class="anchor" href="#creation-of-version-1"></a>Creation of version 1</h4>
<div class="paragraph">
<p>oc new-project master-slaveX</p>
</div>
<div class="paragraph">
<p><strong>(Where X is your user number)</strong></p>
</div>
<div class="paragraph">
<p>oc new-app --name slave-app-v1-0  <a href="https://github.com/marrober/slave-node-app.git" class="bare">https://github.com/marrober/slave-node-app.git</a></p>
</div>
<div class="paragraph">
<p>oc expose service slave-app-v1-0 --name="slave-app-route"</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">What got created ?</div>
<div class="paragraph">
<p>It is important to understand the artefacts and content that are created by the above commands within OpenShift:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A new project is created called master-slaveX.</p>
</li>
<li>
<p>A deployment configuration is created called slave-app-v1-0.</p>
</li>
<li>
<p>A replication controller is created associated with the application and the built objects. This defines the scaling of the application in terms of the number of pods and the deployment strategy (rolling or recreate).</p>
</li>
<li>
<p>A build configuration is created to compile the application source code which is extracted from the associated GIT repository.</p>
</li>
<li>
<p>The build configuration will create a buid instance which includes logs of the build process and a reference to the built image.</p>
</li>
<li>
<p>The newly created image is deployed as a runnning pod (or pods depending on the number of pods defined in the deployment configuration).</p>
</li>
<li>
<p>A service is created as part of the application creation process. The service endpoints will point to the pod(s) created by the build process. In the case of a rebuild and redeploy operation the service endpoints are updated to point to the new pods in accordance with the deployment strategy of the deployment configuration.</p>
</li>
<li>
<p>The service is then exposed external to the cluster by the creation of a route. The route has a fully qualified domain name for access from machines outside the cluster.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The diagram below shows the above and how the relate together.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/deployment-strategies-1.png" alt="Deployment artefacts">
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><strong>To identify the URL of the route execute the command shown below:</strong></p>
</div>
<div class="paragraph">
<p>oc get route slave-app-route -o jsonpath='{"http://"}{.spec.host}{"\n"}'</p>
</div>
<div class="paragraph">
<p><strong>This will display a formatted URL with the 'http://' part at the beginning which will be similar to :</strong></p>
</div>
<div class="paragraph">
<p><a href="http://slave-app-route-master-slave.apps.cluster-xxxx-yyyy.xxxx-yyyy.example.opentlc.com" class="bare">http://slave-app-route-master-slave.apps.cluster-xxxx-yyyy.xxxx-yyyy.example.opentlc.com</a></p>
</div>
<div class="paragraph">
<p>*To test the application use the command line window to issue a curl command to:</p>
</div>
<div class="paragraph">
<p>curl -k &lt;url from the above command&gt;/ip</p>
</div>
<div class="paragraph">
<p><strong>The response should be as shown below (example ip address) :</strong></p>
</div>
<div class="paragraph">
<p>"10.131.0.114 v1.0"</p>
</div>
</div>
<div class="sect3">
<h4 id="creation-of-version-2"><a class="anchor" href="#creation-of-version-2"></a>Creation of version 2</h4>
<div class="paragraph">
<p><strong>The development team now wants to introduce an experimental version 2 of the application and introduce it to the users in a number of different ways. The first action is to create the new build process for the experimental version using the command below.</strong></p>
</div>
<div class="paragraph">
<p>oc new-app --name slave-app-v2-0 <a href="https://github.com/marrober/slave-node-app.git#experimental" class="bare">https://github.com/marrober/slave-node-app.git#experimental</a></p>
</div>
<div class="paragraph">
<p><strong>Note the use of the #experimental branch identifier in the end of the GIT repository. This syntax cannot be used through the web interface to openshift so any requirements for non-standard GIT connectivity must be done through the command line interface. It is also possible to configure the source-2-image capability to reference a specific sub directory of the repository using the --context option.</strong></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">What got added to the project ?</div>
<div class="paragraph">
<p>New content was added to the project as a result of the above command specific to the experimental (v2) version of the application.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A deployment configuration</p>
</li>
<li>
<p>A replication controller</p>
</li>
<li>
<p>A build configuration</p>
</li>
<li>
<p>A running container in a pod</p>
</li>
<li>
<p>A service</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The diagram below shows the above and how the relate together.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/deployment-strategies-2.png" alt="Deployment artefacts">
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><strong>At this point the version 2 application is operational but not accessible externally to the cluster.</strong></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="blue-green-deployment"><a class="anchor" href="#blue-green-deployment"></a>Blue / Green Deployment</h3>
<div class="paragraph">
<p><strong>The benefit of creating the new version of the application alongside the old is that it is quick and easy to migrate users to a new version of the application. It also allows teams to validate that the pods are running correctly.</strong></p>
</div>
<div class="paragraph">
<p><strong>Switching the route from v1 to v2 involves patching the route to change configuration. Before executing this operation open a new command window and execute the command below to send requests to the route every second. The responses received should all include the ip address of the pod and the version (v1) of the application.</strong></p>
</div>
<div class="paragraph">
<p><strong>Get the URI of the route using the command :</strong></p>
</div>
<div class="paragraph">
<p>oc get route slave-app-route -o jsonpath='{"http://"}{.spec.host}{"/ip\n"}'</p>
</div>
<div class="paragraph">
<p><strong>Copy the result of the above command and past it into the shell script below:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">for i in {1..1000}; do curl -k &lt;URI&gt; ; echo ""; sleep 1; done</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>A series of reports of ip address and version 1 of the application will then start to scroll up the screen. Leave this running.</strong></p>
</div>
<div class="paragraph">
<p><strong>Switch back to the original command window and execute the command below to patch the route to version 2 of the application.</strong></p>
</div>
<div class="paragraph">
<p>oc patch route/slave-app-route -p '{"spec":{"to":{"name":"slave-app-v2-0"}}}'</p>
</div>
<div class="paragraph">
<p><strong>Switch back to the command window with the shell script running and you should see the responses have a new ip address and now report v2 of the application. This has completed a migration from the old version of the application to the new.</strong></p>
</div>
<div class="paragraph">
<p><strong>The details of the route patched by the above command are displayed by the command:</strong></p>
</div>
<div class="paragraph">
<p>oc get route/slave-app-route -o yaml</p>
</div>
<div class="paragraph">
<p><strong>The output of the above command is shown below, and the nested information from spec &#8594; to &#8594; name is easy to see.</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">apiVersion: route.openshift.io/v1
kind: Route
metadata:
  annotations:
    openshift.io/host.generated: "true"
  creationTimestamp: 2019-12-04T17:16:37Z
  labels:
    app: slave-app-v1-0
  name: slave-app-route
  namespace: master-slave
  resourceVersion: "884652"
  selfLink: /apis/route.openshift.io/v1/namespaces/master-slave/routes/slave-app-route
  uid: d4910fef-16b9-11ea-a6c5-0a580a800048
spec:
  host: slave-app-route-master-slave.apps.cluster-telf-c8e6.telf-c8e6.example.opentlc.com
  port:
    targetPort: 8080-tcp
  subdomain: ""
  to:
    kind: Service
    name: slave-app-v2-0
    weight: 100
  wildcardPolicy: None
status:
  ingress:
  - conditions:
    - lastTransitionTime: 2019-12-04T17:16:38Z
      status: "True"
      type: Admitted
    host: slave-app-route-master-slave.apps.cluster-telf-c8e6.telf-c8e6.example.opentlc.com
    routerCanonicalHostname: apps.cluster-telf-c8e6.telf-c8e6.example.opentlc.com
    routerName: default
    wildcardPolicy: None</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Before moving to the A/B deployment strategy switch back to version v1 with the command:</strong></p>
</div>
<div class="paragraph">
<p>oc patch route/slave-app-route -p '{"spec":{"to":{"name":"slave-app-v1-0"}}}'</p>
</div>
<div class="paragraph">
<p><strong>Confirm this has worked in the command window executing the shell script.</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="ab-deployment"><a class="anchor" href="#ab-deployment"></a>A/B Deployment</h3>
<div class="paragraph">
<p><strong>The benefit of an A/B deployment strategy is that it is possible to gradually migrate workload to the new version. This example presents a simple process of gradually migrating a higher and higher percentage of traffic to the new version, however more advanced options are available for migrating traffic based on headers or source ip address to name just two. Red Hat OpenShift Service Mesh is another topic that is worth investigation if advanced traffic routing operations are required.</strong></p>
</div>
<div class="paragraph">
<p><strong>Gradually migrating traffic fromv1 to v2 involves patching the route to change configuration as shown below.</strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/deployment-strategies-3.png" alt="Traffic routing">
</div>
</div>
<div class="paragraph">
<p><strong>To migrate 10% of traffic to version 2 execute the following command:</strong>.</p>
</div>
<div class="paragraph">
<p>oc set route-backends slave-app-route slave-app-v1-0=90 slave-app-v2-0=10</p>
</div>
<div class="paragraph">
<p><strong>Switch back to the command window running the shell script and after a short wait you will see the occasional report from version 2.</strong></p>
</div>
<div class="paragraph">
<p><strong>To balance the workload between the two versions execute the following command:</strong></p>
</div>
<div class="paragraph">
<p>oc set route-backends slave-app-route slave-app-v1-0=50 slave-app-v2-0=50</p>
</div>
<div class="paragraph">
<p><strong>Switch back to the command window running the shell script and after a short wait you will see a more even distribution of calls between versions 1 and 2.</strong></p>
</div>
<div class="paragraph">
<p><strong>The details of the route patched by the above command are displayed by the command:</strong></p>
</div>
<div class="paragraph">
<p>oc get route/slave-app-route -o yaml</p>
</div>
<div class="paragraph">
<p><strong>A section of the output of the above command is included below, showing the split of traffic between versions 1 and 2.</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">spec:
  alternateBackends:
  - kind: Service
    name: slave-app-v2-0
    weight: 50
  host: slave-app-route-master-slave.apps.cluster-telf-c8e6.telf-c8e6.example.opentlc.com
  port:
    targetPort: 8080-tcp
  subdomain: ""
  to:
    kind: Service
    name: slave-app-v1-0
    weight: 50</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>When satisfied that version 2 is working as required the following command will switch all traffic to that version and will remove the references to version 1 from the route.</strong></p>
</div>
<div class="paragraph">
<p>oc set route-backends slave-app-route slave-app-v1-0=0 slave-app-v2-0=100</p>
</div>
<div class="sect3">
<h4 id="cleaning-up"><a class="anchor" href="#cleaning-up"></a>Cleaning up</h4>
<div class="paragraph">
<p>From the OpenShift browser window click on 'Advanced' and then 'Projects' on the left hand side menu.</p>
</div>
<div class="paragraph">
<p>In the triple dot menu next to your own project (master-slaveX) select ‘Delete Project’
Type ‘master-slaveX’ (where X is your user number) such that the Delete button turns red and is active.</p>
</div>
<div class="paragraph">
<p>Press Delete to remove the project.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="understanding-the-software-defined-network-within-openshift"><a class="anchor" href="#understanding-the-software-defined-network-within-openshift"></a>Understanding the Software Defined Network within OpenShift</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="introduction-4"><a class="anchor" href="#introduction-4"></a>Introduction</h3>
<div class="paragraph">
<p>This chapter provides a developer-centric view of the fundamentals and capabilities of the SDN (Software Defined Network) that is used within OpenShift for Application connectivity.</p>
</div>
<div class="paragraph">
<p>If you are not already logged on go to the UI URL at <a href="http://console-openshift-console.apps.cluster-devex1-37b5.devex1-37b5.example.opentlc.com" class="bare">http://console-openshift-console.apps.cluster-devex1-37b5.devex1-37b5.example.opentlc.com</a> and logon as 'userx' (x is the number provided to you) and password openshift.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-basics-of-service-addressing"><a class="anchor" href="#the-basics-of-service-addressing"></a>The basics of Service Addressing</h3>
<div class="paragraph">
<p><strong>In this section we will create a couple of simple applications and show how they are represented via the Service and load-balancing of Pods within the SDN itself.</strong></p>
</div>
<div class="paragraph">
<p>Open another tab in the browser and go to the terminal URL <a href="https://terminal-terminal.apps.cluster-devex1-37b5.devex1-37b5.example.opentlc.com/" class="bare">https://terminal-terminal.apps.cluster-devex1-37b5.devex1-37b5.example.opentlc.com/</a> and again logon as 'userx' with password openshift</p>
</div>
<div class="paragraph">
<p>Ensure you are on the Administrator View (top level, select Administrator)</p>
</div>
<div class="paragraph">
<p>Select Home/Projects</p>
</div>
<div class="paragraph">
<p>Click on ‘Create Project’</p>
</div>
<div class="paragraph">
<p>For the project name give it networktestx where x is your user number</p>
</div>
<div class="paragraph">
<p>Display Name and Description are optional</p>
</div>
<div class="paragraph">
<p>Click on 'Create'</p>
</div>
<div class="paragraph">
<p>Using the top left selection switch the UI from Administrator to Developer</p>
</div>
<div class="paragraph">
<p>In the Topology Tab click on ‘From Catalog’</p>
</div>
<div class="paragraph">
<p>In the search box enter ‘node’. Select the Node.js option</p>
</div>
<div class="paragraph">
<p>Click ‘Create Application’</p>
</div>
<div class="paragraph">
<p>Default the image to version 10</p>
</div>
<div class="paragraph">
<p>For the git repo enter ‘https://github.com/utherp0/nodenews’</p>
</div>
<div class="paragraph">
<p>Set the 'Application Name' to ‘application1-app’</p>
</div>
<div class="paragraph">
<p>Set the 'Name' to 'application1'</p>
</div>
<div class="paragraph">
<p>Click 'Create'</p>
</div>
<div class="paragraph">
<p>Click on ‘+Add’</p>
</div>
<div class="paragraph">
<p>Click on ‘From Catalog’</p>
</div>
<div class="paragraph">
<p>In the search box enter ‘node’. Again select the Node.js option</p>
</div>
<div class="paragraph">
<p>Click ‘Create Application’</p>
</div>
<div class="paragraph">
<p>For the git repo enter ‘https://github.com/utherp0/nodenews’</p>
</div>
<div class="paragraph">
<p>Choose 'Create Application' from the Application pulldown</p>
</div>
<div class="paragraph">
<p>Set the 'Application Name' to 'application2-app'</p>
</div>
<div class="paragraph">
<p>Set the Name to ‘application2’</p>
</div>
<div class="paragraph">
<p>Click 'Create'</p>
</div>
<div class="paragraph">
<p>Wait until both applications have built and deployed. The Topology view will look similar to the image below:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/sdn-1.png" alt="Both Applications Loaded">
</div>
</div>
<div class="paragraph">
<p>Once the applications have created change the mode from Developer to Administrator using the top left selection point</p>
</div>
<div class="paragraph">
<p>Click on 'Projects'. Select the networktestx project</p>
</div>
<div class="paragraph">
<p>Click on 'Networking/Services'</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/sdn-2.png" alt="Example Services">
</div>
</div>
<div class="paragraph">
<p><strong>The Services UI shows the services currently availble in the Project. Note that there is a Service per application, so in this case there are two Services, application1 and application2. The Location is a singular IP address for each Service within the SDN - more on this later.</strong></p>
</div>
<div class="paragraph">
<p>Click on 'Workloads/Deployment Configs'</p>
</div>
<div class="paragraph">
<p>Click on the application1 dc</p>
</div>
<div class="paragraph">
<p>Using the arrows next to the Pod indicator scale the application to three replicas</p>
</div>
<div class="paragraph">
<p>Click on ‘Pods’</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/sdn-3.png" alt="Pod Listing">
</div>
</div>
<div class="paragraph">
<p>Click on the first active Pod for application1 listed</p>
</div>
<div class="paragraph">
<p>Scroll down and take a note of the IP address for the Pod</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/sdn-4.png" alt="Highlighted Pod IP">
</div>
</div>
<div class="paragraph">
<p>Click on 'Networking/Services'</p>
</div>
<div class="paragraph">
<p>Click on the application1 service</p>
</div>
<div class="paragraph">
<p><strong>Note that the IP address for the Service has NOT changed. Scaling the Application has no impact on the singular IP address for the Service, which in actuality acts as a load-balancer across ALL of the IP addresses for the Pods of that Application.</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="using-the-shorthand-service-name-directly"><a class="anchor" href="#using-the-shorthand-service-name-directly"></a>Using the shorthand Service name directly</h3>
<div class="paragraph">
<p>Click on 'Workloads/Pods'</p>
</div>
<div class="paragraph">
<p>Click on the first running Pod for application1 (the name will be application1-1-(something)</p>
</div>
<div class="paragraph">
<p>Click on Terminal</p>
</div>
<div class="paragraph">
<p>In the Terminal window type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">curl http://localhost:8080</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>You will see the webpage for the Application as a return from the curl statement. The Container sees itself as localhost. Also note that because we are calling from within the Container we use the port address - if you were using the Routes their would be a Route for every Service, with no port address.</strong></p>
</div>
<div class="paragraph">
<p>In the Terminal window type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">curl http://application1:8080</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>This is where it starts to get interesting. The Service 'name' itself is exported into the network namespace of the Container so it can refer to it as a short name. The SDN translates the service name into the service IP - in reality this Container could be getting a webpage back from any of the Application Pods that satisfy this Service.</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="using-the-fully-qualified-domain-name-for-accessing-services"><a class="anchor" href="#using-the-fully-qualified-domain-name-for-accessing-services"></a>Using the Fully Qualified Domain Name for accessing Services</h3>
<div class="paragraph">
<p>In the Terminal window type (and replace x with your number):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">curl http://application1.networktest(x).svc.cluster.local:8080</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>And this is the fully qualified version of the Service. by including the namespace/project name we can reach, effectively, any service on the SDN assuming the SDN has been configured to allow that. In this case we are just targeting our own Service from the application Container, now we will try the other application in the namespace.</strong></p>
</div>
<div class="paragraph">
<p>In the Terminal window hit the up arrow to get the last command, edit the name and change application1 to application2, hit return at the end of the statement</p>
</div>
<div class="paragraph">
<p><strong>You should a webpage. This is the output of the other application. This long format makes it easy to refer to other applications without having to leave and come back into the SDN (via a Route).</strong></p>
</div>
<div class="paragraph">
<p>In the terminal type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">curl http://application2:8080’</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>We can also connect to any of the Services hosted within the namespace/project by default</strong></p>
</div>
<div class="paragraph">
<p>Ask the person sat next to you what their project name is and make a note of it</p>
</div>
<div class="paragraph">
<p>In the terminal type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">curl http://application1.(the project name from the person next to you).svc.cluster.local:8080</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>OpenShift Container Platform can be installed with two different modes of SDN. The first is subnet, which exposes all Services in all Namespace/Projects to each other. This instance has a subnet SDN which is why you should be able to call other peoples Services directly from your own via the internal FQDN address.</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="controlling-access-through-network-policies"><a class="anchor" href="#controlling-access-through-network-policies"></a>Controlling Access through Network Policies</h3>
<div class="paragraph">
<p>Click on 'Network/Network Policies'</p>
</div>
<div class="paragraph">
<p>For each of the policies listed click on the triple dot icon on the far right and choose ‘Delete Network Policy’.</p>
</div>
<div class="paragraph">
<p>image::sdn-5.png</p>
</div>
<div class="paragraph">
<p>The Network Policy tab should display ‘No Network Policies Found’.</p>
</div>
<div class="paragraph">
<p>Go to Workloads/Pods, click on one of the application1 Pods, choose Terminal</p>
</div>
<div class="paragraph">
<p>Repeat the ‘curl’ command listed above for the person sat next to you, i.e. curl their application1</p>
</div>
<div class="paragraph">
<p>Ensure you get a webpage</p>
</div>
<div class="paragraph">
<p>Go to Network/Network Policies</p>
</div>
<div class="paragraph">
<p>Click on ‘Create Network Policy’</p>
</div>
<div class="paragraph">
<p>Enter the following - remember to change YOURNUMBERHERE to your user number</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
 name: example
 namespace: networktestYOURNUMBERHERE
spec:
 podSelector:
   matchLabels:
     app: application1
 ingress: []</code></pre>
</div>
</div>
<div class="paragraph">
<p>Click ‘Create’</p>
</div>
<div class="paragraph">
<p>Wait until the person next to you has done the same</p>
</div>
<div class="paragraph">
<p>Click on 'Workloads/Pods', click on one of the application1 Pods, choose Terminal</p>
</div>
<div class="paragraph">
<p>Repeat the ‘curl’ command listed above for the person sat next to you, i.e. curl their application1</p>
</div>
<div class="paragraph">
<p>The call will eventually fail - feel free to hit Ctrl-C to interrupt</p>
</div>
<div class="paragraph">
<p><strong>The creation of a Network Policy that prohibits ingress to the Application Service has stopped access to the Service from external namespaces AND internal Services.</strong></p>
</div>
<div class="paragraph">
<p>Click on 'Workloads/Pods'</p>
</div>
<div class="paragraph">
<p>Click on the active pod for application2</p>
</div>
<div class="paragraph">
<p>Click on Terminal</p>
</div>
<div class="paragraph">
<p>Type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">curl http://application1:8080</code></pre>
</div>
</div>
<div class="paragraph">
<p>The call will eventually fail</p>
</div>
<div class="paragraph">
<p><strong>This shows that the Service is prohibited even from Services in its own namespace/project. This application of Network Policy allows for fine-grain control of traffic egress/ingress at the Service level. The other installation mode for SDN for OpenShift 4 is with Network Policies enabled, with default Network Policies providing a fully multitenanted environment.</strong></p>
</div>
<div class="paragraph">
<p>Click on 'Projects'</p>
</div>
<div class="paragraph">
<p>On the triple dot icon on the far right for networktestxx select ‘Delete Project’</p>
</div>
<div class="paragraph">
<p>In the pop-up enter the name of the project (‘networktestxx’ with your number) and hit Delete</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="the-rbac-model-for-developers"><a class="anchor" href="#the-rbac-model-for-developers"></a>The RBAC model for Developers</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="introduction-5"><a class="anchor" href="#introduction-5"></a>Introduction</h3>
<div class="paragraph">
<p><strong>This chapter will introduce the attendee to the concepts around the Role Based Access Control model integrated into OpenShift. This will cover the use of Users, Service Accounts and Permissions.</strong></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For the majority of this chapter the attendee will need to pair up with another. If the numbers are odd the presenter should fill the gap of the missing attendee - pair the attendees up before the chapter starts and get them to exchange numbers - remember the numbers as MYUSER and PARTNERUSER
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you are not already logged on go to the UI URL <a href="http://console-openshift-console.apps.cluster-devex1-37b5.devex1-37b5.example.opentlc.com" class="bare">http://console-openshift-console.apps.cluster-devex1-37b5.devex1-37b5.example.opentlc.com</a> and logon as 'userx' (x is the number provided to you) and password openshift.</p>
</div>
<div class="paragraph">
<p>Open another tab in the browser and go to the terminal URL <a href="https://terminal-terminal.apps.cluster-devex1-37b5.devex1-37b5.example.opentlc.com/" class="bare">https://terminal-terminal.apps.cluster-devex1-37b5.devex1-37b5.example.opentlc.com/</a> and again logon as userx with password openshift</p>
</div>
<div class="paragraph">
<p>Ensure you are on the Administrator View (top level, select Administrator)</p>
</div>
<div class="paragraph">
<p>In the UI click on 'Home/Projects'</p>
</div>
<div class="paragraph">
<p>Click on 'Create Project'</p>
</div>
<div class="paragraph">
<p>For the project name give it rbactestx where x is your user number</p>
</div>
<div class="paragraph">
<p>Display Name and Description are optional</p>
</div>
<div class="paragraph">
<p>Click on 'Create'</p>
</div>
</div>
<div class="sect2">
<h3 id="examining-service-accounts"><a class="anchor" href="#examining-service-accounts"></a>Examining Service Accounts</h3>
<div class="paragraph">
<p>Once the project has been created, click on 'Administration/Service Accounts'</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/rbac-1.png" alt="List of Service Accounts">
</div>
</div>
<div class="paragraph">
<p><strong>Service Accounts are effectively virtual users - even though you have logged on when you do anything within the namespace, such as a build or a deployment, the namespace uses a virtual user, with appropriate permissions, to do the actual tasks internally, like pushing a built image to the registry, or pulling an image to start a Container.</strong></p>
</div>
<div class="paragraph">
<p><strong>Each project gets a Service Account by default, named default or to give it its full name system:serviceaccount:rbactestx:default (where x is your number). There are also Service Accounts for doing the appropriate actions, such as Builder and Deployer</strong></p>
</div>
<div class="paragraph">
<p><strong>In addition further Service Accounts can be created by the project owner and given additional security details and roles, such as being able to execute Containers as root, or giving Containers specific controlled sec-comp profiles (like changing the Group ID for the process)</strong></p>
</div>
<div class="paragraph">
<p>Switch to the Developer view using the top left pulldown</p>
</div>
<div class="paragraph">
<p>In the Topology Tab click on ‘From Catalog’</p>
</div>
<div class="paragraph">
<p>In the search box enter ‘node’. Select the Node.js option</p>
</div>
<div class="paragraph">
<p>Click ‘Create Application’</p>
</div>
<div class="paragraph">
<p>Default the image to version 10</p>
</div>
<div class="paragraph">
<p>For the git repo enter ‘https://github.com/utherp0/nodenews’</p>
</div>
<div class="paragraph">
<p>Set the Application Name to ‘rbac’</p>
</div>
<div class="paragraph">
<p>Set the Name to ‘rbactest’</p>
</div>
<div class="paragraph">
<p>Click 'Create'</p>
</div>
<div class="paragraph">
<p>Click on the Node pod indicator so the informational panel appears</p>
</div>
<div class="paragraph">
<p>Watch the build and ensure it completes</p>
</div>
<div class="paragraph">
<p>Once the build is complete ensure the deployment occurs. The Pod ring will turn dark blue</p>
</div>
<div class="paragraph">
<p>Switch back to Administrator view using the top left selection point</p>
</div>
<div class="paragraph">
<p>Click on 'Home/Projects'</p>
</div>
<div class="paragraph">
<p>Click on Administration/Role Bindings</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/rbac-2.png" alt="Admin Role">
</div>
</div>
<div class="paragraph">
<p><strong>Note that we have one Role Binding shown at the moment, which is for Admin and applies to a kind of 'user' and a subject name of 'userx'. This is the binding of your user to the administration role within the project.</strong></p>
</div>
<div class="paragraph">
<p>Click on the 'System Role Bindings'</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/rbac-3.png" alt="System Role Bindings">
</div>
</div>
<div class="paragraph">
<p><strong>Note that with the addition of System Role Bindings to the screen we can now see the three Service Accounts also created. Deployer is part of the system:deployers binding, builder is part of the system:image-builders binding and the group of users under system:serviceaccounts:rbactestx (where x is your number) have the system:image-pullers binding.</strong></p>
</div>
<div class="paragraph">
<p>Click on the (CR) admin Role Ref</p>
</div>
<div class="paragraph">
<p><strong>This screen displays ALL the actions, via API, that this role has access to grouped by the API groups. This mapping is what controls what the user can do via the bindings they have.</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="adding-role-bindings-to-your-namespaceproject"><a class="anchor" href="#adding-role-bindings-to-your-namespaceproject"></a>Adding Role Bindings to your namespace/project</h3>
<div class="paragraph">
<p>Click on 'Administration/Role Bindings'</p>
</div>
<div class="paragraph">
<p>Click on 'Create Binding'</p>
</div>
<div class="paragraph">
<p>Set Name to ‘partneraccess’</p>
</div>
<div class="paragraph">
<p>Select ‘rbactestx’ from the Namespace pulldown; it should be the only one.</p>
</div>
<div class="paragraph">
<p><strong>As a user with the admin role within the namespace/project you can add other users with role bindings within your project.</strong></p>
</div>
<div class="paragraph">
<p>Select ‘Admin’ in the Role Name pulldown</p>
</div>
<div class="paragraph">
<p>Ensure ‘User’ is selected in the radiobox for Subject</p>
</div>
<div class="paragraph">
<p>Enter ‘userPARTNERUSER’ for the Subject Name</p>
</div>
<div class="paragraph">
<p><strong>What we are doing is adding the user you have chosen to pair with as an admin role binding within your project.</strong></p>
</div>
<div class="paragraph">
<p>Click 'Create'</p>
</div>
<div class="paragraph">
<p>Ensure the partner has done the same with your userx</p>
</div>
<div class="paragraph">
<p>Click on Home/Projects</p>
</div>
<div class="paragraph">
<p><strong>If the partner user has set the role binding appropriately you will now see two projects - your own and the other person&#8217;s</strong></p>
</div>
<div class="paragraph">
<p>Click on the partner’s project (rbactestPARTNERUSER)</p>
</div>
<div class="paragraph">
<p>Change to the Developer view using the top left selection point</p>
</div>
<div class="paragraph">
<p>Ensure you can see the Topology page</p>
</div>
<div class="paragraph">
<p>Change back to the Administrator view using the top left selection point</p>
</div>
<div class="paragraph">
<p>Select 'Workloads/Deployment Configs'</p>
</div>
<div class="paragraph">
<p>Ensure that the ‘rbactest’ DC shown has a Namespace that is the Partner’s project</p>
</div>
<div class="paragraph">
<p>Click on the DC rbactest</p>
</div>
<div class="paragraph">
<p>Using the arrows scale the deployment to 4 pods</p>
</div>
<div class="paragraph">
<p>Click on 'Home/Projects' and select your project (rbactestMYUSER)</p>
</div>
<div class="paragraph">
<p>Click on ‘Role Bindings’ in the project overview pane</p>
</div>
<div class="paragraph">
<p>On the triple dot for ‘partneraccess’ choose ‘Delete’</p>
</div>
<div class="paragraph">
<p>Confirm deletion in the pop-up message box</p>
</div>
</div>
<div class="sect2">
<h3 id="giving-users-lower-levels-of-permission"><a class="anchor" href="#giving-users-lower-levels-of-permission"></a>Giving Users lower levels of permission</h3>
<div class="paragraph">
<p>Click on 'Administration/Role Bindings'</p>
</div>
<div class="paragraph">
<p>Click on 'Create Binding'</p>
</div>
<div class="paragraph">
<p>Set Name to ‘partneraccess’</p>
</div>
<div class="paragraph">
<p>Choose the ‘rbactestMYUSER’ in the Namespace pulldown</p>
</div>
<div class="paragraph">
<p>Select ‘view’ in the Role Name pull down</p>
</div>
<div class="paragraph">
<p>Ensure the Subject radiobox is set to ‘User’</p>
</div>
<div class="paragraph">
<p>In the Subject Name enter the user name for the partner (userPARTNERUSER)</p>
</div>
<div class="paragraph">
<p>Click Create</p>
</div>
<div class="paragraph">
<p>Ensure the partner has done the same with your userx</p>
</div>
<div class="paragraph">
<p>Click on 'Home/Projects'</p>
</div>
<div class="paragraph">
<p>Select the partner project (rbactestPARTNERUSER)</p>
</div>
<div class="paragraph">
<p>In the Project overview pane click on Role Bindings</p>
</div>
<div class="paragraph">
<p><strong>You now do not have the appropriate access rights to interact with the role bindings as you only have View access to the target project,</strong></p>
</div>
<div class="paragraph">
<p>Click on 'Workloads/Deployment Config'</p>
</div>
<div class="paragraph">
<p>Click on the rbactest (DC)</p>
</div>
<div class="paragraph">
<p>Try and scale down the Pod to one pod</p>
</div>
<div class="paragraph">
<p><strong>View access allows you to see the state of objects but NOT to change them.</strong></p>
</div>
<div class="paragraph">
<p>Click on 'Home/Projects'</p>
</div>
<div class="paragraph">
<p>In the triple dot menu next to the rbactestPARTNERUSER select ‘Delete Project’</p>
</div>
<div class="paragraph">
<p>Type ‘rbactestPARTNERUSER’ in the message box and press ‘Delete’</p>
</div>
<div class="paragraph">
<p><strong>Note that you cannot delete the other persons project.</strong></p>
</div>
<div class="paragraph">
<p>Hit Cancel</p>
</div>
<div class="paragraph">
<p>In the triple dot menu next to your own project (rbactestMYUSER) select ‘Delete Project’</p>
</div>
<div class="paragraph">
<p>Type ‘rbactestMYUSER’ in the message box and press ‘Delete’</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="understanding-persistent-volumes"><a class="anchor" href="#understanding-persistent-volumes"></a>Understanding Persistent Volumes</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="introduction-6"><a class="anchor" href="#introduction-6"></a>Introduction</h3>
<div class="paragraph">
<p>If you are not already logged on go to the UI URL <a href="http://console-openshift-console.apps.cluster-devex1-37b5.devex1-37b5.example.opentlc.com" class="bare">http://console-openshift-console.apps.cluster-devex1-37b5.devex1-37b5.example.opentlc.com</a> and logon as userx (x is the number provided to you) and password openshift.</p>
</div>
<div class="paragraph">
<p>Open another tab in the browser and go to the terminal URL <a href="https://terminal-terminal.apps.cluster-devex1-37b5.devex1-37b5.example.opentlc.com/" class="bare">https://terminal-terminal.apps.cluster-devex1-37b5.devex1-37b5.example.opentlc.com/</a> and again logon as userx with password openshift</p>
</div>
<div class="paragraph">
<p>Ensure you are on the Administrator View (top level, select Administrator)</p>
</div>
<div class="paragraph">
<p>Click on ‘Create Project’</p>
</div>
<div class="paragraph">
<p>Enter ‘pvtestx’ for the name, where x is your user number</p>
</div>
<div class="paragraph">
<p>Enter ‘PV Test’ for the Display Name and Description</p>
</div>
<div class="paragraph">
<p>Hit ‘Create’</p>
</div>
<div class="paragraph">
<p>Switch to the Developer UI (click on Developer in the top left pulldown)</p>
</div>
<div class="paragraph">
<p>Select ‘From Catalog’</p>
</div>
<div class="paragraph">
<p>Search for ‘node’</p>
</div>
<div class="paragraph">
<p>Click on the ‘node.js’ option</p>
</div>
<div class="paragraph">
<p>Click ‘Create Application’</p>
</div>
<div class="paragraph">
<p>Leave the Builder Image Version as ‘10’</p>
</div>
<div class="paragraph">
<p>Enter the following for the Git Repo URL - ‘https://github.com/utherp0/workshop4’</p>
</div>
<div class="paragraph">
<p>Click on ‘Show Advanced Git Options’</p>
</div>
<div class="paragraph">
<p>In Context Dir put ‘/nodeatomic’</p>
</div>
<div class="paragraph">
<p>In Application Name put ‘nodeatomic’</p>
</div>
<div class="paragraph">
<p>In Name put ‘nodeatomic’</p>
</div>
<div class="paragraph">
<p>Click on ‘Create’</p>
</div>
<div class="paragraph">
<p>When the Topology page appears click on the node Pod to see the information window</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/pvs-1.png" alt="Active Application">
</div>
</div>
<div class="paragraph">
<p>Ensure the build completes correctly</p>
</div>
<div class="paragraph">
<p>In the informational panel choose ‘Action/Edit Count’</p>
</div>
<div class="paragraph">
<p>Up the count to 4 and hit ‘Save’</p>
</div>
<div class="paragraph">
<p>Watch the Topology and ensure four copies of the Pod appear and are healthy</p>
</div>
</div>
<div class="sect2">
<h3 id="adding-a-persistent-volume-to-an-application"><a class="anchor" href="#adding-a-persistent-volume-to-an-application"></a>Adding a Persistent Volume to an Application</h3>
<div class="paragraph">
<p>Switch to the Administrator view (top left pulldown)</p>
</div>
<div class="paragraph">
<p>Click on 'Storage/Persistent Volume Claims'</p>
</div>
<div class="paragraph">
<p>Click on ‘Create Persistent Volume Claim’</p>
</div>
<div class="paragraph">
<p>Leave the Storage Class as ‘gp2’</p>
</div>
<div class="paragraph">
<p><strong>Storage Classes are objects configured by the Administrator of the Cluster which allow you to request externalised persistent storage for your Applications. In this case we are using the default storage class for the Cluster which happens to be AWS storage</strong></p>
</div>
<div class="paragraph">
<p>Set the Persistent Volume Claim Name to ‘testpvx’ where x is your user number</p>
</div>
<div class="paragraph">
<p>Ensure the Access Mode is set to ‘RWO’</p>
</div>
<div class="paragraph">
<p><strong>The Access Mode for a Persistent Volume defines how the storage is offered to the Applications. If you choose RWO, Read/Write/Once, a single piece of storage is allocated which is shared across ALL instances of the Application. If you choose RWM, Read/Write/Many, the volume will be created independently on all Nodes where the Application runs, meaning the storage will only be shared by co-resident Pods on Nodes.</strong></p>
</div>
<div class="paragraph">
<p>Set the size to 1Gi</p>
</div>
<div class="paragraph">
<p>Ensure the Use Label Selectors checkbox is not set</p>
</div>
<div class="paragraph">
<p>Click on ‘Create’</p>
</div>
<div class="paragraph">
<p>Click on Storage/Persistent Volume Claims</p>
</div>
<div class="paragraph">
<p><strong>The status of the claim will sit at 'Pending'. This is because the Persistent Volume itself is not created until it is assigned to a Deployment Config.</strong></p>
</div>
<div class="paragraph">
<p>Click on 'Workloads/Deployment Configs'</p>
</div>
<div class="paragraph">
<p>Click on the nodeatomic DC</p>
</div>
<div class="paragraph">
<p>Click on 'Actions/Add Storage'</p>
</div>
<div class="paragraph">
<p>In the Add Storage page ensure ‘Use existing claim’ is checked</p>
</div>
<div class="paragraph">
<p>In the ‘Select Claim’ pulldown select the created claim (testpvx based on your user number)</p>
</div>
<div class="paragraph">
<p>Set the Mount Path to ‘/pvtest/files’</p>
</div>
<div class="paragraph">
<p><strong>What this will do is to export the Persistent Volume into the file space of the Containers at the mount point stated.</strong></p>
</div>
<div class="paragraph">
<p>Click on ‘Save’</p>
</div>
<div class="paragraph">
<p><strong>As we have changed the configuration of the Deployment, and the default triggers are set to redeploy if the Image changes OR the configuration of the Deployment changes, a redeployment will now occur.</strong></p>
</div>
<div class="paragraph">
<p>When the deployment has completed, click on ‘Pods’</p>
</div>
<div class="paragraph">
<p>Select the first running Pod - take a note of its name (nodeatomic-2-xxxxx) - click on the Pod</p>
</div>
<div class="paragraph">
<p>Click on Terminal</p>
</div>
<div class="paragraph">
<p>In the terminal window type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">df -h’</code></pre>
</div>
</div>
<div class="paragraph">
<p>*Note the *</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/pvs-2.png" alt="Additional file mount">
</div>
</div>
<div class="paragraph">
<p>In the terminal window type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">ls -alZ /pvtest/files</code></pre>
</div>
</div>
<div class="paragraph">
<p>Click on 'Networking/Routes'</p>
</div>
<div class="paragraph">
<p>On the Location of the nodeatomic RT (route) press the right mouse button (two fingers on the Mac mousepad) and select ‘Open link in new tab’</p>
</div>
<div class="paragraph">
<p>Ensure the OpenShift NodeAtomic Example webpage is displayed</p>
</div>
<div class="paragraph">
<p>Add ‘/containerip’ to the end of the URL in the browser window and hit return</p>
</div>
<div class="paragraph">
<p>Take a note of the address returned</p>
</div>
<div class="paragraph">
<p>Switch back to the OCP UI and choose Workloads/Pods</p>
</div>
<div class="paragraph">
<p>Click on <strong>each</strong> of the Pods until you find the one that has the IP returned by the webpage, take a note of the Pod name ('*1')</p>
</div>
<div class="paragraph">
<p>Go back to the tab with the nodeatomic webpage in it</p>
</div>
<div class="paragraph">
<p>Remove ‘/containerip’ from the end of the URL and replace it with ‘/fileappend?file=/pvtest/files/webfile1.txt&amp;text=Hello%20World’ and then press return</p>
</div>
<div class="paragraph">
<p>Ensure the webservice returns ‘Updated '/pvtest/files/webfile1.txt' with 'Hello World'’</p>
</div>
<div class="paragraph">
<p>Switch back to the browser tab with the OCP UI in it. Select 'Workloads/Pods' and click on the Pod with the name that matches the IP discovered in ('*1')</p>
</div>
<div class="paragraph">
<p>Click on 'Terminal'</p>
</div>
<div class="paragraph">
<p>In the terminal type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">cat /pvtest/files/webfile1.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ensure ‘Hello World’ is displayed</p>
</div>
<div class="paragraph">
<p><strong>The Webservice endpoint provided appends the given text to the given file.</strong></p>
</div>
<div class="paragraph">
<p>Click on 'Workloads/Pods'</p>
</div>
<div class="paragraph">
<p>Select another Pod (<strong>NOT</strong> the one that matched the IP from the (*1) step</p>
</div>
<div class="paragraph">
<p>Click on 'Terminal'</p>
</div>
<div class="paragraph">
<p>In the terminal type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">cat /pvtest/files/webfile1.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note that this separate Pod has the SAME file with the same contents</strong></p>
</div>
<div class="paragraph">
<p>Switch back to the nodeatomic webservice browser tab</p>
</div>
<div class="paragraph">
<p>Alter the end of the URL to read ‘Hello%20Again’ and press return</p>
</div>
<div class="paragraph">
<p>Return to the OCP UI tab window (the terminal should still be active) and type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">cat /pvtest/files/webfile1.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Again note the file has been updated by another container but this container shares the same file system.</strong></p>
</div>
<div class="paragraph">
<p>Close the web service browser tab</p>
</div>
</div>
<div class="sect2">
<h3 id="demonstrating-survivability-of-removal-of-all-pods"><a class="anchor" href="#demonstrating-survivability-of-removal-of-all-pods"></a>Demonstrating survivability of removal of all Pods</h3>
<div class="paragraph">
<p>Click on 'Workloads/Deployment Configs'</p>
</div>
<div class="paragraph">
<p>Click on the nodeatomic DC</p>
</div>
<div class="paragraph">
<p>Scale to ZERO pods</p>
</div>
<div class="paragraph">
<p>Ensure the Pod graphic displays zero running Pods.</p>
</div>
<div class="paragraph">
<p>Scale the deployment back up to ONE Pod using the arrows</p>
</div>
<div class="paragraph">
<p>When the Pod indicator goes to dark blue indicating the Pod has started, click on Pods</p>
</div>
<div class="paragraph">
<p>Select the one active Pod and click on it</p>
</div>
<div class="paragraph">
<p>Click on 'Terminal'</p>
</div>
<div class="paragraph">
<p>In the terminal window type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">---
cat /pvtest/files/webfile1.txt
----</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note that the contents of the file have survived the destruction of ALL Pods</strong></p>
</div>
<div class="paragraph">
<p>Click on 'Home/Projects'</p>
</div>
<div class="paragraph">
<p>On the triple dot next to the ‘pvtestx’ project (where x is your user number) select Delete Project</p>
</div>
<div class="paragraph">
<p>In the pop-up type ‘pvtestx’ (where x is your user number) and hit Delete</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="healthprobes"><a class="anchor" href="#healthprobes"></a>Pod Health Probes</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="introduction-7"><a class="anchor" href="#introduction-7"></a>Introduction</h3>
<div class="paragraph">
<p>Liveness and Readiness probes are Kubernetes capabilities that enable teams to make their containerised applications more reliable and robust. However, if used inappropriately they can result in none of the intended benefits, and can actually make a microservice based application unstable.</p>
</div>
<div class="paragraph">
<p>The purpose of each probe is quite simple and is described well in the OpenShift documentation here. The use of each probe is best understood by examining the action that will take place if the probe is activated.</p>
</div>
<div class="paragraph">
<p><strong>Liveness</strong> : Under what circumstances is it appropriate to restart the pod?</p>
</div>
<div class="paragraph">
<p><strong>Readiness</strong> : under what circumstances should we take the pod out of the list of service endpoints so that it no longer responds to requests?</p>
</div>
<div class="paragraph">
<p>Coupled with the action of the probe is the type of test that can be performed within the pod :</p>
</div>
<div class="paragraph">
<p><strong>Http GET request</strong> : For success, a request to a specific http endpoint must result in a response between 200 and 399.</p>
</div>
<div class="paragraph">
<p><strong>Execute a command</strong> : For success, the execution of a command within the container must result in a return code of 0.</p>
</div>
<div class="paragraph">
<p><strong>TCP socket check</strong> : For success, a specific TCP socket must be successfully opened on the container.</p>
</div>
</div>
<div class="sect2">
<h3 id="creating-the-project-and-application"><a class="anchor" href="#creating-the-project-and-application"></a>Creating the project and application</h3>
<div class="paragraph">
<p>Log on to cluster as userx, password openshift</p>
</div>
<div class="paragraph">
<p>Ensure you are on the Administrator View (top level, select Administrator)</p>
</div>
<div class="paragraph">
<p><strong>The Administrator view provides you with an extended functionality interface that allows you to deep dive into the objects available to your user. The Developer view is an opinionated interface designed to ease the use of the system for developers. This workshop will have you swapping between the contexts for different tasks.</strong></p>
</div>
<div class="paragraph">
<p>Click on 'Create Project'</p>
</div>
<div class="paragraph">
<p>Name - ‘probesX’ where X is your assigned user number</p>
</div>
<div class="paragraph">
<p>Display Name - 'Probes'</p>
</div>
<div class="paragraph">
<p>Desciption - 'Liveness and readiness probes'</p>
</div>
<div class="paragraph">
<p>as shown in the image below:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/healthprobes-1.png" alt="Project creation">
</div>
</div>
<div class="paragraph">
<p><strong>By default when you create a Project within OpenShift your user is given administration rights. This allows the user to create any objects that they have rights to create and to change the security and access settings for the project itself, i.e. add users as Administrators, Edit Access, Read access or disable other user&#8217;s abilities to even see the project and the objects within.</strong></p>
</div>
<div class="paragraph">
<p><strong>In the top left of the UI, where the label indicates the view mode, change the mode from Administrator to Developer and select the Topology view.</strong></p>
</div>
<div class="paragraph">
<p>Select ‘From Catalog’</p>
</div>
<div class="paragraph">
<p>Enter ‘node’ in the search box</p>
</div>
<div class="paragraph">
<p><strong>The various catalogue items present different configurations of applications that can be created. For example the node selections include a simple node.js application or node.js with a database platform that is pre-integrated and ready to use within the application. For this workshop you will use a simple node.js application.</strong></p>
</div>
<div class="paragraph">
<p>Select ‘Node.js’</p>
</div>
<div class="paragraph">
<p><strong>A wizard page will then pop up on the right hand side with details of exactly what will be created through the process.</strong></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Source-2-Image</div>
<div class="paragraph">
<p>One of the most exciting features of OpenShift from a developer&#8217;s perspective is the concept of S2I, or <strong>Source-2-Image</strong> which provides a standardised way of taking a base image, containing, for example, the framework for running a node.js application,
a source code repository, containing the code of the application that matches the framework provided in the base image, and constructing  and delivering a composite Application image to the Registry. Simply put this enables a developer to create source code for an application and OpenShift will convert that to a running application within a container with minimal effort. The process that you will use below is the Source-2-Image capability.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Click on ‘Create Application’</p>
</div>
<div class="paragraph">
<p><strong>The wizard process has a number of options that the user may elect to use. These include:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Selecting a specific version of Node to use</p>
</li>
<li>
<p>Selecting a GIT repository and choosing to use code from a specific directory within the repository.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Select the default offering for the Builder Image Version</p>
</div>
<div class="paragraph">
<p>For the GIT repository use : <a href="https://github.com/marrober/slave-node-app.git" class="bare">https://github.com/marrober/slave-node-app.git</a></p>
</div>
<div class="paragraph">
<p>In a separate browser tab go to <a href="https://github.com/marrober/slave-node-app.git" class="bare">https://github.com/marrober/slave-node-app.git</a></p>
</div>
<div class="paragraph">
<p><strong>You can see that the GIT repository at this location only has a small number of files specific to the application. There is no content specific to how the application should be built or deployed into a container.</strong></p>
</div>
<div class="paragraph">
<p>Close the github tab</p>
</div>
<div class="paragraph">
<p>Back at the OCP4.2 user interface complete the following information in the section titmed 'General'.</p>
</div>
<div class="paragraph">
<p>For the Application drop down menu select 'Create Application'.</p>
</div>
<div class="paragraph">
<p>For the Application name enter 'Slave-application'.</p>
</div>
<div class="paragraph">
<p>For the Name field enter 'node-app-slave'</p>
</div>
<div class="paragraph">
<p><strong>The application name field is used to group together multiple items under a single grouping within the topology view. The name field is used to identify the specific containerised application.</strong></p>
</div>
<div class="paragraph">
<p>Ensure the ‘Create a route to the application’ checkbox is checked.</p>
</div>
<div class="paragraph">
<p>Click Create</p>
</div>
<div class="paragraph">
<p><strong>The user interface will then change to display the Topology view. This is a pictorial representation of the various items (applications, databases etc.) that have been created from the catalogue and added to an application grouping.</strong></p>
</div>
<div class="paragraph">
<p><strong>Multiple application groupings can exist within a single project.</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="viewing-the-running-application"><a class="anchor" href="#viewing-the-running-application"></a>Viewing the running application</h3>
<div class="paragraph">
<p>Click on the Icon marked ‘Node’</p>
</div>
<div class="paragraph">
<p><strong>A side panel will appear with information on the Deployment Configuration that has just been created. The overview tab shows summary information and allows the user to scale the number of pods up and down. The resources tab shows information on the building process, the pods and the services and route to reach the application (if these have been created).</strong></p>
</div>
<div class="paragraph">
<p>Wait for the Build to finish, the Pod to change from Container Creating to Running.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Pod Colour Scheme</div>
<div class="paragraph">
<p>The colour scheme of the pods is important and conveys information about the pod health and status. The following colours are used :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Running - Dark blue</p>
</li>
<li>
<p>Not Ready - Mid blue</p>
</li>
<li>
<p>Warning - Orange</p>
</li>
<li>
<p>Failed - Red</p>
</li>
<li>
<p>Pending - light blue</p>
</li>
<li>
<p>Succeeded - Green</p>
</li>
<li>
<p>Terminating - Black</p>
</li>
<li>
<p>Unknown - Purple</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>When the build has completed the right hand side panel will shown something similar to the image below. Note that the route will be different to that which is shown below.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/healthprobes-2.png" alt="Deployment configuration resource information">
</div>
</div>
<div class="paragraph">
<p>Click on the Tick at the bottom left of the Pod. Note that this display can also be shown by clicking on the ‘View Logs’ section on the right hand side panel.</p>
</div>
<div class="paragraph">
<p><strong>The build log will show information on the execution of the source-2-image process.</strong></p>
</div>
<div class="paragraph">
<p>Click on the arrow on the top right corner of the Pod, or click on the route URL shown in the right hand side resource details window. The application window will launch in a new browser window and should display text as shown below:</p>
</div>
<div class="paragraph">
<p><strong>Hello - this is the simple slave REST interface</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="liveness-probe"><a class="anchor" href="#liveness-probe"></a>Liveness Probe</h3>
<div class="paragraph">
<p><strong>A number of probes will be created to show the different behaviours. The first probe will be a liveness probe that will result in the restart of the pod.</strong></p>
</div>
<div class="paragraph">
<p><strong>To create the probe use the OC command line interface to execute the following command.</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">oc set probe dc/node-app-slave --liveness --initial-delay-seconds=30 --failure-threshold=1 --period-seconds=10 --get-url=http://:8080/health</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>The above probe will create a new liveness probe with the characteristics:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Become active after 30 seconds</p>
</li>
<li>
<p>Initiated a reboot after 1 instance of a failure to respond</p>
</li>
<li>
<p>Probe the application every 10 seconds <em>Note that ordinarily a gap of 10 seconds between probes would be considered very long, but we use this time delay within the workshop to allow time for observing the behaviour of the probe.</em></p>
</li>
<li>
<p>Use the URL /health on the application at port 8080. Note that there is no need to specify a URL for the application.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>The command line response should be as shown below.</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">deploymentconfig.apps.openshift.io/node-app-slave probes updated</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Review the liveness probe information by executing the command:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">oc describe dc/node-app-slave</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>The output of this command will include the following section that highlights the new liveness probe</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">Pod Template:
  Labels:	app=node-app-slave
		    deploymentconfig=node-app-slave
  Containers:
   node-app-slave:
    Image:		image-registry.openshift-image-registry.svc:5000/probes2/node-app-slave@sha256:bf377...241
    Port:		    8080/TCP
    Host Port:		0/TCP
    Liveness:		http-get http://:8080/health delay=30s timeout=1s period=10s #success=1 #failure=1
    Environment:	&lt;none&gt;
    Mounts:		    &lt;none&gt;
  Volumes:		    &lt;none&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Alternatively to view the probe in a different format use the command below:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">oc get dc/node-app-slave -o yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Part of the output will show:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">livenessProbe:
    failureThreshold: 1
    httpGet:
        path: /health
        port: 8080
        scheme: HTTP
    initialDelaySeconds: 30
    periodSeconds: 10
    successThreshold: 1
    timeoutSeconds: 1</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>To view the above information graphically then use the following steps:</strong></p>
</div>
<div class="paragraph">
<p>Select the Topology view of the application.</p>
</div>
<div class="paragraph">
<p>Click on the pod in the centre of the screen to display the information panel on the right hand side.
From the action menu on the right hand side click <strong>Edit Deployment Configuration</strong> as shown in the image below.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/healthprobes-3.png" alt="View of the health probe in the Deployment Configuration">
</div>
</div>
<div class="paragraph">
<p><strong>On the Deployment Configuration page that is displayed ensure that the YAML tab is selected and scroll down to aroundline 68 to see the YAML definition for the liveness probe. It is also possible to edit the parameters of the probe from this screen if necessary.</strong></p>
</div>
<div class="paragraph">
<p><strong>In order to execute the probe it is necessary to simulate a pod failure that will stop the application from responding to the health check. A specific REST interface on the application has been created for this purpose called /ignore.</strong></p>
</div>
<div class="sect3">
<h4 id="activation-of-the-liveness-prove"><a class="anchor" href="#activation-of-the-liveness-prove"></a>Activation of the Liveness Prove</h4>
<div class="paragraph">
<p><strong>To view the activity of the probe it is necessary to open two windows.</strong></p>
</div>
<div class="paragraph">
<p>Select the Topology view of the application.</p>
</div>
<div class="paragraph">
<p>Click on the arrow on the top right hand corner of the node icon to open the application URL in a new browser tab.</p>
</div>
<div class="paragraph">
<p>Back on the OpenShift browser tab, Click on the pod to open the details window on the right hand side and then click on the pod link on the resources tab. This will display a multi-tab window with details of the pod, select the events tab.</p>
</div>
<div class="paragraph">
<p>Switch to the application tab and put /ip on the end of the url and hit return. This will display the ip address of the pod.</p>
</div>
<div class="paragraph">
<p>Change the url to have /health on the end and hit return. This will display the amount of time that the pod has been running.</p>
</div>
<div class="paragraph">
<p>Change the url to have /ignore on the end and hit return. Quickly move to the browser tab showing the pod events and watch for the probe event.</p>
</div>
<div class="paragraph">
<p>The pod will restart after 1 failed probe event which takes up to 10 seconds depending on where the schedule is between the probe cycles. The events for the pod on the details screen will be similar to that shown below.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/healthprobes-4.png" alt="Pod events showing activation of the liveness probe">
</div>
</div>
<div class="paragraph">
<p><strong>The events after the firing of the liveness probe are the re-pulling and starting of the container image in a new pod.</strong></p>
</div>
<div class="paragraph">
<p>Switch to the application tab and put /health on the end of the url and hit return. This will display the amount of time that the new pod has been running, which will understandably be a small number.</p>
</div>
<div class="paragraph">
<p><strong>In order to experiment with the readiness probe it is necessary to switch off the liveness probe. This can either be done by changing the deployment configuration YAML definition using the web interface or by executing the following command line:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">oc set probe dc/node-app-slave --liveness --remove</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="readiness-probe"><a class="anchor" href="#readiness-probe"></a>Readiness Probe</h3>
<div class="paragraph">
<p><strong>To create the probe use the OC command line interface to execute the following command.</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">oc set probe dc/node-app-slave --readiness --initial-delay-seconds=30 --failure-threshold=3 --success-threshold=1  --period-seconds=5 --get-url=http://:8080/health</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>The above command will create a new readiness probe with the characteristics:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Become active after 30 seconds</p>
</li>
<li>
<p>Remove the pod from the service endpoint after 3 instances of a failure to respond</p>
</li>
<li>
<p>Cancel the removal of the pod and add it back to the service endpoint after 1 successful response</p>
</li>
<li>
<p>Probe the application every 5 seconds</p>
</li>
<li>
<p>Use the URL /health on the application at port 8080. Note that there is no need to specify a URL for the application.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>The command line response should be as shown below</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">deploymentconfig.apps.openshift.io/node-app-slave probes updated</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Review the probe created using the commands above:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">oc describe dc/node-app-slave</code></pre>
</div>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">oc get dc/node-app-slave -o yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>View the state of the pod within the endpoints using the command below:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">oc get ep/node-app-slave -o yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>The output of the above command will list the details of the service endpoint which will include information on the pod to which the health probe is attached as shown below.</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">apiVersion: v1
kind: Endpoints
metadata:
  annotations:
    endpoints.kubernetes.io/last-change-trigger-time: 2019-11-26T16:04:50Z
  creationTimestamp: 2019-11-26T09:37:12Z
  labels:
    app: node-app-slave
    app.kubernetes.io/component: node-app-slave
    app.kubernetes.io/instance: node-app-slave
    app.kubernetes.io/name: nodejs
    app.kubernetes.io/part-of: master-slave
    app.openshift.io/runtime: nodejs
    app.openshift.io/runtime-version: "10"
  name: node-app-slave
  namespace: probes1
  resourceVersion: "1172051"
  selfLink: /api/v1/namespaces/probes1/endpoints/node-app-slave
  uid: 534139aa-1030-11ea-af1c-024039909e8a
subsets:
- addresses:
  - ip: 10.128.2.145
    nodeName: ip-10-0-136-74.eu-central-1.compute.internal
    targetRef:
      kind: Pod
      name: node-app-slave-5-hwj89
      namespace: probes1
      resourceVersion: "1172049"
      uid: ad6cc0e5-1043-11ea-af1c-024039909e8a
  ports:
  - name: 8080-tcp
    port: 8080
    protocol: TCP</code></pre>
</div>
</div>
<div class="paragraph">
<p>The lies of interest above are:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">subsets:
- addresses:
  - ip: 10.128.2.145</code></pre>
</div>
</div>
<div class="paragraph">
<p>This shows that the address is currently part of the endpoint (it will participate in servicing requests) prior to the readiness probe activation.</p>
</div>
<div class="sect3">
<h4 id="activation-of-the-readiness-probe"><a class="anchor" href="#activation-of-the-readiness-probe"></a>Activation of the Readiness Probe</h4>
<div class="paragraph">
<p>Select the Topology view of the application.</p>
</div>
<div class="paragraph">
<p>Click on the arrow on the top right hand corner of the node icon to open the application URL in a new browser tab (unless you already have one open).</p>
</div>
<div class="paragraph">
<p>On the OpenShift browser tab, click on the pod to open the details window on the right hand side and then click on the pod link on the resources tab. This will display a multi-tab window with details of the pod, select the events tab.</p>
</div>
<div class="paragraph">
<p>Switch to the application tab and put /ip on the end of the url and hit return. This will display the ip address of the pod.</p>
</div>
<div class="paragraph">
<p>Change the url to have /health on the end and hit return. This will display the amount of time that the pod has been running.</p>
</div>
<div class="paragraph">
<p>Change the url to have /ignore on the end and hit return. Quickly move to the browser tab showing the pod events and watch for the probe event.</p>
</div>
<div class="paragraph">
<p>The pod events will show a screen similar to that which is shown below.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/healthprobes-5.png" alt="Pod events showing activation of the readiness probe">
</div>
</div>
<div class="paragraph">
<p><strong>Note that you will see the count of the readiness 'events' incrementing every 5 seconds.</strong></p>
</div>
<div class="paragraph">
<p><strong>You will also see that the events continue counting up since readiness probes do not stop firing just because the pod has been removed from the endpoint list. It is important that they continue to probe since the conditions may change and it may be appropriate to add the pod back into the endpoint list.</strong></p>
</div>
<div class="paragraph">
<p>View the state of the pod within the endpoints using the command below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">oc get ep/node-app-slave -o yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>The output of the above command will list the details of the service endpoint which will include information on the pod to which the health probe is attached as shown below.</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">subsets:
- notReadyAddresses:
  - ip: 10.128.2.145</code></pre>
</div>
</div>
<div class="paragraph">
<p>The subset of the command output shown above indicates that the address is now listed as ‘not ready’ and is not currently part of the endpoint.</p>
</div>
<div class="paragraph">
<p><strong>Under production use conditions for the application may change and the pod may recover from the inability to respond to the readiness probe. If this happens then it will be added back to the endpoint list.</strong></p>
</div>
<div class="paragraph">
<p><strong>To simulate this the Node application has a REST endpoint at /restore. Since the pod is currently not receiving communications from outside the cluster the call to the restore endpoint is done from within the pod command window.</strong></p>
</div>
<div class="paragraph">
<p>Switch to the OpenShift browser window that was showing the pod events.</p>
</div>
<div class="paragraph">
<p><strong>Note that you will see a large number of pod readiness probe failures while you were reading the notes.</strong></p>
</div>
<div class="paragraph">
<p>Select the terminal window tab and enter the command :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">curl -k localhost:8080/restore</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>You should see a response similar to that shown below (with a different IP address):</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">"10.128.2.146 restore switch activated"sh-4.2$</code></pre>
</div>
</div>
<div class="paragraph">
<p>View the state of the pod within the endpoints using the command below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">oc get ep/node-app-slave -o yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>You should see that the line of interest, previously shown above, has changed back to that shown below:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">subsets:
- addresses:
  - ip: &lt;ip address of the pod&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>On the OpenShift browser page switch back to the events tab and you should see that the readiness probe failure count is no longer increasing.</strong></p>
</div>
<div class="paragraph">
<p>Finally, switch to the application browser page and change the URL to end in /health. You should see that the application has been running for some time (compared to the liveness probe that showed a restart had taken place) and it should be responding successfully to the health probe.</p>
</div>
</div>
<div class="sect3">
<h4 id="cleaning-up-2"><a class="anchor" href="#cleaning-up-2"></a>Cleaning up</h4>
<div class="paragraph">
<p>From the OpenShift browser window click on 'Advanced' and then 'Projects' on the left hand side menu.</p>
</div>
<div class="paragraph">
<p>In the triple dot menu next to your own project (ProbesX) select ‘Delete Project’
Type ‘ProbesX’ (where X is your user number) such that the Delete button turns red and is active.</p>
</div>
<div class="paragraph">
<p>Press Delete to remove the project.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="openshift-do"><a class="anchor" href="#openshift-do"></a>OpenShift DO</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="introduction-8"><a class="anchor" href="#introduction-8"></a>Introduction</h3>
<div class="paragraph">
<p><strong>The OpenShift command line interface 'oc' is a general purpose interface with a vast set of commands for both development and administrative purposes. The odo command is a more developer centric command line interface for users who simply want to build, deploy and run applications on OpenShift. There is definitely a place for both tools within the kitbag of an OpenShift user, and for fast iterations of edit - run - edit - run the odo interface is perfect.</strong></p>
</div>
<div class="paragraph">
<p><strong>The approach described in the application basics chapter used a GIT repository as the source of the content to be built and deployed. This is a excellent approach when multiple users are working together in a complex application performing frequent integration of source code in GIT and validating their combined efforts as the project progresses. Avoiding such frequent integration activity will make the code of each developer diverge storing up integration headaches in the future.</strong></p>
</div>
<div class="paragraph">
<p><strong>The ability of the OpenShift 'Source-2-image' capability to identify the code within the GIT repository (from the options of Node.js, Java, Ruby, Perl, PHP, and Python), select a builder image, build the code and deliver a new container with the running application is a huge efficiency advantage for teams. However there are scenarios in which a single developer simply wants to get their code running as quickly as possible and which is where odo can be advantageous.</strong></p>
</div>
<div class="paragraph">
<p><strong>The principle of the odo command is that it can very quickly create a new project and use a 'GIT like' syntax to enable a developer to push the code into OpenShift. The receiving OpenShift cluster will then decide how to build the code, perform the build and deliver a running container. When the developer wants to make changes they simply push their code and the build and deploy operations are repeated. The first push process may take around a minute, but after that each iteration will take only a few seconds.</strong></p>
</div>
<div class="paragraph">
<p><strong>The diagram below shows how the odo command can fit into a development cycle. The outline diagram shows that the odo command is appropriate for single developers working with a degree of isolation, the team development involves multiple developers integrating their code through a GIT repository and the final phase involves the use of multiple clusters for the deployment of applications through to production.</strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/odo-1.png" alt="odo in the development cycle">
</div>
</div>
<div class="paragraph">
<p><strong>In more detail the diagram below shows how odo and oc / source-2-image work together to create a scaled development experience. In the single user phase the odo command is used to push the application code to a container in OpenShift. In the light blue box the source code is pushed to OpenShift in which the language specific builder image is used to create a new image containing the built code. This  image is started to create a running container. When the developer needs to share the code with the work of others GIT is used as a vehicle for integration and to remove any code conflicts.  This is the medium blue box in which the code is pushed to GIT and the OpenShift source-2-image capability is used to build a new running container. In the final phase shown in the darker blue box, the built container image can then be pushed to the Quay image repository to be stored securely ready for deployment to further environments such as pre-production and production.</strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/odo-2.png" alt="odo in the development cycle - detail">
</div>
</div>
</div>
<div class="sect2">
<h3 id="installing"><a class="anchor" href="#installing"></a>Installing</h3>
<div class="paragraph">
<p>The odo command line interface is available for download from here : <a href="https://github.com/openshift/odo" class="bare">https://github.com/openshift/odo</a></p>
</div>
<div class="paragraph">
<p><strong>The Applications Basics chapter describes two different mechanisms for getting access to the command line tools for this workshop. If you are using the terminal within a container (option 2) then you already have the odo command line available to you. If you have chosen to install the command line utilities locally on your laptop then you will need to install odo using the download location above.</strong></p>
</div>
<div class="paragraph">
<p><strong>To use the command simply type 'odo' and you will see help regarding the objects and to get help on a specific object use 'odo &lt;object&gt; --help'.</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="odo-command-set"><a class="anchor" href="#odo-command-set"></a>odo command set</h3>
<div class="paragraph">
<p><strong>The odo command has the following subcommands :</strong></p>
</div>
<div class="paragraph">
<p>Commands:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>app         Perform application operations (delete, describe, list)
catalog     Catalog related operations (describe, list, search)
component   Manage components (create, delete, describe, link, list, log, push, unlink, update, watch)
config      Change or view configuration (set, unset, view)
debug       Debug commands (port-forward)
preference  Modifies preference settings (set, unset, view)
project     Perform project operations (create, delete, get, list, set)
service     Perform service catalog operations (create, delete, list)
storage     Perform storage operations (create, delete, list)
url         Expose component to the outside world (create, delete, list)</pre>
</div>
</div>
<div class="paragraph">
<p>Utility Commands:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>login       Login to cluster
logout      Log out of the current OpenShift session
utils       Utilities for terminal commands and modifying odo configurations (terminal)
version     Print the client version information</pre>
</div>
</div>
<div class="paragraph">
<p>Component Shortcuts:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>create      Create a new component
delete      Delete component
describe    Describe component
link        Link component to a service or component
list        List all components in the current application
log         Retrieve the log for the given component
push        Push source code to a component
unlink      Unlink component to a service or component
update      Update the source code path of a component
watch       Watch for changes, update component on change</pre>
</div>
</div>
<div class="paragraph">
<p><strong>The most common are used within this workshop but feel free to experiment with any of the above commands.</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="logging-in"><a class="anchor" href="#logging-in"></a>Logging in</h3>
<div class="paragraph">
<p><strong>To login using odo enter the command :</strong></p>
</div>
<div class="paragraph">
<p>odo login &lt;user-name&gt;</p>
</div>
<div class="paragraph">
<p><strong>If you are already logged in with the oc command then the credentials will be cached (assuming you use the same user name) and you will not have to enter a password.</strong></p>
</div>
<div class="paragraph">
<p><strong>The odo command will evolve over time and it performs a check to see if you have the latest version each time it is used. If there is an update available you will see a prompt similar to that which is shown below, underneath the text reporting the project that you are using.</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">---
A newer version of odo (v1.0.2) is available,
visit https://github.com/openshift/odo/releases to update.
If you wish to disable this notification, run:
odo preference set UpdateNotification false
---</code></pre>
</div>
</div>
<div class="paragraph">
<p>*To see which version of odo you are using enter the command : *</p>
</div>
<div class="paragraph">
<p>odo version</p>
</div>
<div class="sect3">
<h4 id="download-source-assets"><a class="anchor" href="#download-source-assets"></a>Download source assets</h4>
<div class="paragraph">
<p><strong>The pipeline assets are located in a GIT repository. Using your terminal window download the assets using the command below (if you have not done so for a previous chapter).</strong></p>
</div>
<div class="paragraph">
<p>If you are using the terminal in a pod ensure that the current directory is /workspace. If you are using your local machine select an appropriate location to which you have write access.</p>
</div>
<div class="paragraph">
<p>git clone <a href="https://github.com/utherp0/workshop4.git" class="bare">https://github.com/utherp0/workshop4.git</a></p>
</div>
<div class="paragraph">
<p>cd workshop4/attendee/slave</p>
</div>
<div class="paragraph">
<p>ls -al</p>
</div>
<div class="paragraph">
<p><strong>You will see that the directory only has the source file slave.js and the package file called package.json.</strong></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="create-push-source-run-cycle"><a class="anchor" href="#create-push-source-run-cycle"></a>Create, push source &amp; run cycle</h3>
<div class="paragraph">
<p><strong>Create a new project using the odo command replacing X with your user number below.</strong></p>
</div>
<div class="paragraph">
<p>odo create nodejs node-app-slave --project master-slave-odo</p>
</div>
<div class="paragraph">
<p><strong>The syntax of the above command is :</strong></p>
</div>
<div class="paragraph">
<p><strong>odo create &lt;component-type&gt; &lt;component-name&gt; --project &lt;project-for-the-component&gt;</strong></p>
</div>
<div class="paragraph">
<p><strong>The result of running this command is simply the creation of a .odo directory containing a config.yaml file. The file contains the desired state for the application in OpenShift and is only committed to OpenShift and acted upon by OpenShift when the user issues the command 'odo push'. Examine the config.yaml file with the command:</strong></p>
</div>
<div class="paragraph">
<p>cat .odo/config.yaml</p>
</div>
<div class="paragraph">
<p><strong>Create a route for the application by using the command below:</strong></p>
</div>
<div class="paragraph">
<p>odo url create node-app-slave</p>
</div>
<div class="paragraph">
<p><strong>Examine the contents of the .odo/config.yaml file again and you will see that new content has been added:</strong></p>
</div>
<div class="paragraph">
<p>cat .odo/config.yaml</p>
</div>
<div class="paragraph">
<p><strong>Push the configuration to OpenShift:</strong></p>
</div>
<div class="paragraph">
<p>odo push</p>
</div>
<div class="paragraph">
<p><strong>The output from the above command is shown below:</strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/odo-3.png" alt="odo in the development cycle - detail">
</div>
</div>
<div class="paragraph">
<p><strong>The application is started up and will be running at the URL indicated in the output above. Copy the URL from your command window and paste it into a new browser tab. You should see an output similar to that shown below.</strong></p>
</div>
<div class="paragraph">
<p>Hello - this is the simple slave REST interface v1.0</p>
</div>
<div class="paragraph">
<p><strong>Make a small change to the comment in the source code of the slave.js file to change the line shown below:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">response.send('Hello - this is the simple slave REST interface' + versionIdentifier);</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Change to :</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">response.send('Hello - MODIFIED and pushed with ODO' + versionIdentifier);</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Push the change to OpenShift:</strong></p>
</div>
<div class="paragraph">
<p>odo push</p>
</div>
<div class="paragraph">
<p><strong>The code still needed to be pushed to the component, but the final stage of building the component is much faster. Refresh the browser widow showing the application output and you will see your code change. The edit - push - test cycle is as simple as that.</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="odo-watch"><a class="anchor" href="#odo-watch"></a>odo watch</h3>
<div class="paragraph">
<p><strong>The odo process also has a 'watch' facility that allows you to force odo to constantly watch for source code changes and push them immediately. If you are using the terminal in a container open a second window so that you have two terminal windows. If you are using your local laptop simply open another terminal window. Ensure that the new terminal window is in the same directory as the first terminal window. Enter the command below to make odo watch for source code changes:</strong></p>
</div>
<div class="paragraph">
<p>odo watch</p>
</div>
<div class="paragraph">
<p><strong>The command window should report : 'Waiting for something to change in &lt;current-working-directory&gt;'</strong></p>
</div>
<div class="paragraph">
<p><strong>Switch back to your other terminal window and make another change to the source code, similar to the change above. After saving the edit switch to the terminal window in which you typed 'odo watch' and observe that a new push of the code to OpenShift has taken place.</strong></p>
</div>
<div class="paragraph">
<p><strong>The window with the watch command running will report:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">File &lt;path-to-source&gt;/slave.js changed
Pushing files...
 ✓  Waiting for component to start [73ms]
 ✓  Syncing files to the component [11s]
 ✓  Building component [4s]</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Refresh the browser widow showing the application output and you will see your code change.</strong></p>
</div>
<div class="paragraph">
<p><strong>odo is clearly a very fast way to go from code to running your application without having to install tools and frameworks on your laptop.</strong></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="openshift-pipelines-tekton"><a class="anchor" href="#openshift-pipelines-tekton"></a>OpenShift Pipelines - Tekton</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="introduction-9"><a class="anchor" href="#introduction-9"></a>Introduction</h3>
<div class="paragraph">
<p><strong>For many years teams have created automation pipelines to build, unit test, analyse and deploy applications in a variety of tool-chains. Some such tool-chains (Jenkins for one) pre-date the popularisation of containers and are now being questioned for their fit for the delivery of cloud native applications. While we are at pains not to criticise Jenkins (we are big users and fans) there is scope to look at alternative approaches for cloud native applications.</strong></p>
</div>
<div class="paragraph">
<p><strong>OpenShift Pipelines are based on the Tekton open source project and they provide a Kubernetes style, resource based approach to the construction of pipelines. Tasks are defined as small units of operations (typically 10 to 15 lines of YAML) and such tasks are grouped together into taskruns or pipelines for execution</strong>.</p>
</div>
<div class="paragraph">
<p><strong>A new command line exists for the execution of Tekton commands and a graphical user interface can be added to the cluster to provide a simple way to run tasks and to observe running or completed tasks.</strong></p>
</div>
<div class="paragraph">
<p>The Tekton project can be found here : <a href="https://tekton.dev/" class="bare">https://tekton.dev/</a></p>
</div>
<div class="paragraph">
<p>Further documentation on the specifics of Tekton can be found on the github site here : <a href="https://github.com/tektoncd/pipeline" class="bare">https://github.com/tektoncd/pipeline</a></p>
</div>
</div>
<div class="sect2">
<h3 id="create-a-project"><a class="anchor" href="#create-a-project"></a>Create a project</h3>
<div class="paragraph">
<p><strong>Create a project to use for the OpenShift pipeline examples called pipelines-userX replacing X with your user number in the following command:</strong></p>
</div>
<div class="paragraph">
<p>oc new-project pipelines-userX</p>
</div>
<div class="paragraph">
<p><strong>In order to use the pipeline capability of OpenShift within the project the following commands must be executed to manage the security profile of the project:</strong></p>
</div>
<div class="paragraph">
<p>oc adm policy add-scc-to-user privileged -z pipeline</p>
</div>
<div class="paragraph">
<p>oc adm policy add-role-to-user edit -z pipeline</p>
</div>
</div>
<div class="sect2">
<h3 id="tasks"><a class="anchor" href="#tasks"></a>Tasks</h3>
<div class="sect3">
<h4 id="download-pipeline-assets"><a class="anchor" href="#download-pipeline-assets"></a>Download pipeline assets</h4>
<div class="paragraph">
<p><strong>The pipeline assets are located in a GIT repository. Using your terminal window download the assets using the command below.</strong></p>
</div>
<div class="paragraph">
<p>If you are using the terminal in a pod ensure that the current directory is /workspace. If you are using your local machine select an appropriate location to which you have write access.</p>
</div>
<div class="paragraph">
<p>git clone <a href="https://github.com/utherp0/workshop4.git" class="bare">https://github.com/utherp0/workshop4.git</a></p>
</div>
<div class="paragraph">
<p>cd workshop4/attendee/tekton/</p>
</div>
<div class="paragraph">
<p>ls -al</p>
</div>
<div class="paragraph">
<p>You should now see a list of yaml files that are used during the remainder of this chapter.</p>
</div>
</div>
<div class="sect3">
<h4 id="simple-task-creation-and-execution"><a class="anchor" href="#simple-task-creation-and-execution"></a>Simple task creation and execution</h4>
<div class="paragraph">
<p><strong>In the simplest format a task can be executed by a taskrun object. The digram below shows a simple taskrun calling a single task.</strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/pipelines-1.png" alt="Simple pipeline with a task and taskrun">
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Tekton command line</div>
<div class="paragraph">
<p>A new command line utility is used to manage the Tekton command line. The commands cover the various different pipeline objects such as task, taskrun, pipeline, pipelinerun,  resources, cluster tasks and conditions.</p>
</div>
<div class="paragraph">
<p>The Tekton command line is downloaded from here : <a href="https://github.com/tektoncd/cli" class="bare">https://github.com/tektoncd/cli</a></p>
</div>
<div class="paragraph">
<p>If you are using the terminal within a container (option 2) from the installation details in the Application Basics chapter then you already have the tkn command line available to you. If you have chosen to install the command line utilities locally on your laptop then you will need to install tkn using the download location above.</p>
</div>
<div class="paragraph">
<p>To use the command simply type 'tkn' and you will see help regarding the objects and to get help on a specific object use 'tkn &lt;object&gt; --help'.</p>
</div>
</div>
</div>
<div class="paragraph">
<p><strong>To execute the above pipeline use the following commands to create the pipeline objects. Note that when creating the taskrun objects the associated task(s) will run immediately.</strong></p>
</div>
<div class="paragraph">
<p>oc create -f task-1.yaml</p>
</div>
<div class="paragraph">
<p>oc create -f taskrun-1.yaml</p>
</div>
<div class="paragraph">
<p>tkn taskrun ls</p>
</div>
<div class="paragraph">
<p><strong>The response from the last command will display a line similar to the following:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">NAME          STARTED           DURATION      STATUS
task-run-1    9 seconds ago     ---           Running(Pending)</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Repeat the final command a few times until you see it change to the following:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">NAME          STARTED           DURATION      STATUS
task-run-1    3 minuites ago    21 seconds    Succeeded</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>The result of running the task can then be viewed by executing the following command:</strong></p>
</div>
<div class="paragraph">
<p>tkn taskrun logs task-run-1</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">[echo-statement-1] This is my first task in Tekton

[echo-statement-2] ------------------------------------------------------------
[echo-statement-2]   - This is a multi-line comment
[echo-statement-2]   - This is useful as a separator but each line has
[echo-statement-2]   - the title repeated next to it using different colours
[echo-statement-2]   - which helps with the identification of different tasks.
[echo-statement-2]  ------------------------------------------------------------
[echo-statement-2]</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note that the command response above uses different colours for each block of command result titles in the [ ] brackets. This helps to differential between the response for each step.</strong></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pipelines"><a class="anchor" href="#pipelines"></a>Pipelines</h3>
<div class="paragraph">
<p><strong>Pipelines are used to manage the execution of a series of tasks within a pipeline. The example pipeline below is used to execute the Tekton tasks : task-1, task-2 and task-3. Remember that each Tekton task can have multiple steps within it.</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">apiVersion: tekton.dev/v1alpha1
kind: Pipeline
metadata:
  name: pipeline-1
spec:
  tasks:
  - name: task-1
    taskRef:
      name: task-1
  - name: task-2
    taskref:
      name: task-2
  - name: task-3
    taskref:
      name: task-3</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Before executing this pipeline create the required additional resources with the commands :</strong></p>
</div>
<div class="paragraph">
<p>oc create -f task-2.yaml</p>
</div>
<div class="paragraph">
<p>oc create -f task-3.yaml</p>
</div>
<div class="paragraph">
<p>oc create -f pipeline-1.yaml</p>
</div>
<div class="paragraph">
<p><strong>Execute the pipeline with the following Tekton task</strong>.</p>
</div>
<div class="paragraph">
<p>tkn pipeline start pipeline-1</p>
</div>
<div class="paragraph">
<p><strong>The output of running this command will be something similar to that which is shown below:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">Pipelinerun started: pipeline-1-run-ffxsk
Showing logs...
[task-2 : what-directory] /workspace

[task-2 : describe-command] ------------------------------------------------------------
[task-2 : describe-command]   - Openshift oc command line example
[task-2 : describe-command]  ------------------------------------------------------------
[task-2 : describe-command]

[task-2 : oc-version] Client Version: unknown
[task-2 : oc-version] Kubernetes Version: v1.14.6+76aeb0c

[task-3 : echo-statement-3] echo - statement 3
[task-1 : echo-statement-1] This is my first task in Tekton


[task-3 : echo-statement-4] echo - statement 4

[task-1 : echo-statement-2] ------------------------------------------------------------
[task-1 : echo-statement-2]   - This is a multi-line comment
[task-1 : echo-statement-2]   - This is useful as a separator but each line has
[task-1 : echo-statement-2]   - the title repeated next to it using different colours
[task-1 : echo-statement-2]   - which helps with the identification of different tasks.
[task-1 : echo-statement-2]  ------------------------------------------------------------</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>There may be an issue in the order of the execution above. The order of the pipeline expected is different to the order observed:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">   Expected               Actual
task 1 - step 1       task 2 - step 1
task 1 - step 2       task 2 - step 2
task 2 - step 1       task 2 - step 3
task 2 - step 2       task 3 - step 1
task 2 - step 3       task 1 - step 1
task 3 - step 1       task 3 - step 2
task 3 - step 2       task 1 - step 2</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>In some pipelines the order of execution may not matter but if it does the order can be managed by the addition of the 'runAfter' directive to a specific task as shown in the update to the pipeline-1 pipeline shown below:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">apiVersion: tekton.dev/v1alpha1
kind: Pipeline
metadata:
  name: pipeline-1
spec:
  tasks:
  - name: task-1
    taskRef:
      name: task-1
  - name: task-2
    taskref:
      name: task-2
    runAfter:
    - task-1
  - name: task-3
    taskref:
      name: task-3
    runAfter:
    - task-2</code></pre>
</div>
</div>
<div class="paragraph">
<p>Make the above changes to the pipeline-1.yaml file and then remove the pipeline definition and recreate it before re-running it with the commands :</p>
</div>
<div class="paragraph">
<p>oc delete -f pipeline-1.yaml</p>
</div>
<div class="paragraph">
<p>oc create -f pipeline-1.yaml</p>
</div>
<div class="paragraph">
<p>tkn pipeline start pipeline-1</p>
</div>
<div class="paragraph">
<p><strong>This time the execution will follow the intended order.</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="viewing-pipelines-through-the-web-ui"><a class="anchor" href="#viewing-pipelines-through-the-web-ui"></a>Viewing pipelines through the Web UI</h3>
<div class="paragraph">
<p><strong>Pipelines and pipeline runs are visible through the OpenShift web user interface.</strong></p>
</div>
<div class="paragraph">
<p>Ensure that you are on the 'Developer' view of the OpenShift web user interface as shown below and select the project created above from the drop down list.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/pipelines-2.png" alt="Developer view of OpenShift WEB UI">
</div>
</div>
<div class="paragraph">
<p>Select the pipelines tab on the left hand side of the screen.</p>
</div>
<div class="paragraph">
<p>You will see the pipeline recently created and it will show a green bar to the right indicating the previous successful execution of the pipeline, as shown below. Note that the green bar will display dark blue sections for running tasks, light blue sections for pending tasks, green for completed and red for failed.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/pipelines-3.png" alt="Pipeline view showing a completed pipeline run">
</div>
</div>
<div class="paragraph">
<p>From the three dot menu on the right hand side it is possible to start a run of the pipeline. Do this now and watch as the screen changes to show the details of the pipeline run as shown below:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/pipelines-4.png" alt="Pipelinerun in progress">
</div>
</div>
<div class="paragraph">
<p>Each block can be clicked on to show the details of the steps within the task. Experiment with the different screens to look at the details of the running or completed tasks.</p>
</div>
</div>
<div class="sect2">
<h3 id="task-inputs"><a class="anchor" href="#task-inputs"></a>Task inputs</h3>
<div class="paragraph">
<p><strong>There will be scenarios where it is necessary to provide specific parameters to a pipeline process and the underlying tasks that the pipeline call.</strong></p>
</div>
<div class="paragraph">
<p><strong>There are two mechanisms for getting specific values into tasks :</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>parameters - used to provide specific values to tasks at runtime. If a parameter is declared it must either have a default value defined within the task or it must have a value supplied from a calling taskrun or pipeline run.</p>
</li>
<li>
<p>pipeline resources - a reference to a defined resource object that can be accessed by a Tekton pipeline. If a resource is referenced by a task then the resource must exist unless it has been defined as an optional resource in the task definition.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Pipeline Resource Types</div>
<div class="paragraph">
<p>The following pipeline resource types exist :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Git Resource - The git resource identifies a git repository, that contains the source code to be built by the pipeline. The resource can point to a specific branch or commit and can extract content from a specific directory.</p>
</li>
<li>
<p>Pull Request - Can be used as an input resource to identify specific meta data about a pull request. if used as an output a pull request can be updated with changes made during the pipeline process.</p>
</li>
<li>
<p>Image - An image to be created as part of the pipeline process.</p>
</li>
<li>
<p>Cluster Resource - A different cluster to the cluster on which the pipeline is running. This can be used to deploy content to an alternative cluster as part of a deployment pipeline process.</p>
</li>
<li>
<p>Storage Resource - Blob storage that contains either an object or directory.</p>
</li>
<li>
<p>Cloud Event Resource - A cloud event that is sent to a target URI upon completion of a TaskRun.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Further details on the options for all of the above resources is included here : <a href="https://github.com/tektoncd/pipeline/blob/master/docs/resources.md" class="bare">https://github.com/tektoncd/pipeline/blob/master/docs/resources.md</a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="task-input-example"><a class="anchor" href="#task-input-example"></a>Task input example</h4>
<div class="paragraph">
<p><strong>The task defined in task-4.yaml uses both parameters and pipeline resources to get information into the task. This allows a generic task to be written with specific values supplied to it from the taskrun. The Taskrun object acts as a 'value provider' giving specific values for parameters and referencing specific pipeline resources. The following diagram shows the relationship between the three specific objects.</strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/pipelines-5.png" alt="Task and resource relationship">
</div>
</div>
<div class="paragraph">
<p><strong>As shown above the task has place-holders for two parameters. The first parameter has a value defined within the taskrun. The second parameter has a default value so it is not essential to provide a value for it in the taskrun. Both parameters are referenced from the steps of the task using the notation $(inputs.params.&lt;parameter-name&gt;).</strong></p>
</div>
<div class="paragraph">
<p><strong>The task also defines a resource object called git-repo-slave of type git. Within the taskrun an input resource object is defined with the same name (git-repo-slave) referring to a pipeline resource object called git-repo-slave-resource. A pipeline resource object is created from the yaml file git-resources.yaml which makes a reference to the actual git repository.</strong></p>
</div>
<div class="paragraph">
<p><strong>To create the resource object execute the following command :</strong></p>
</div>
<div class="paragraph">
<p>oc create -f git-resources.yaml</p>
</div>
<div class="paragraph">
<p><strong>To view the resources in the project use the command:</strong></p>
</div>
<div class="paragraph">
<p>tkn resources list</p>
</div>
<div class="paragraph">
<p><strong>The response will be :</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">NAME                      TYPE   DETAILS
git-repo-slave-resource   git    url: https://github.com/marrober/slave-node-app.git</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>The use of pipeline resource objects for git repositories and created images (as output resources) helps teams to create generic build, test and deploy pipelines that can be reused across multiple projects where the projects simply define the custom pipeline resource objects that are specific to their project or environment.</strong></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="workspaces-and-volumes"><a class="anchor" href="#workspaces-and-volumes"></a>Workspaces and Volumes</h3>
<div class="paragraph">
<p><strong>Workspaces allow you to organise the content used by tasks and the assets that are produced by tasks. This can be useful to add structure to the content during large complex pipelines. Workspaces are storage structures within the pod that runs the containers of the pipeline and workspaces are scoped at the task level. Separate steps within a task can see the same workspace. Volumes are similar to workspaces except for the fact that they are backed by persistent volumes. This ensures that content written to the volume is accessible by steps from multiple tasks, allowing for a greater separation of steps into different tasks. For example a generic build task could be used to create an executable, writing the deliverable to a volume. A separate testing task could then be invoked by a pipeline to perform tests against the newly created deliverable. Accessing the file via a volume will work for the two separate tasks.</strong></p>
</div>
<div class="paragraph">
<p><strong>Task 5 has steps for creating files in the workspace and in a volume, followed by steps to display the files in the workspace and the volume which work fine. Task 6 only has tasks for attempting to display the content of the workspace and the volume. Since the workspace in task 6 is a different workspace to that used in task 5 there is no content to display. The volume however shows the file written in the step in task 5. Tasks 5 and 6 are orchestrated by the pipeline called pipeline-5.</strong></p>
</div>
<div class="paragraph">
<p>Create the persistent volume claim to use in this exercise with the command :</p>
</div>
<div class="paragraph">
<p>oc create -f persistentvolumeclaim.yaml</p>
</div>
<div class="paragraph">
<p>Create tasks 5 and 6 :</p>
</div>
<div class="paragraph">
<p>oc create -f task-5.yaml</p>
</div>
<div class="paragraph">
<p>oc create -f task-6.yaml</p>
</div>
<div class="paragraph">
<p>Create the pipeline task :</p>
</div>
<div class="paragraph">
<p>oc create -f pipeline-5.yaml</p>
</div>
<div class="paragraph">
<p><strong>The persistent volume will show that it is in an pending state after creation as no resource has attempted to consume it. After the task has been executed look again at the persistent volume and it will show that it is bound.</strong></p>
</div>
<div class="paragraph">
<p>oc get pvc</p>
</div>
<div class="paragraph">
<p><strong>Before executing the task</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">NAME                    STATUS        VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE
tekton-task-cache-pvc   Pending                                                                            gp2            4s</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>After executing the task</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">NAME                    STATUS        VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE
tekton-task-cache-pvc   Bound         pvc-1d894a93-2646-11ea-9f45-0a9970779e5c   1Gi        RWO            gp2            2m2s</code></pre>
</div>
</div>
<div class="paragraph">
<p>Execute the pipeline :</p>
</div>
<div class="paragraph">
<p>tkn pipeline start pipeline-5</p>
</div>
<div class="paragraph">
<p>The results (including the colour of the output) is shown below:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/pipelines-6.png" alt="Workspace and volume example output">
</div>
</div>
<div class="paragraph">
<p><strong>As shown above in task 5 the creation of the file in the workspace and in the volume functions as required and the files are present. When task 6 attempts to display the files there is an empty workspace, but the volume does show the file created in task 5</strong></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="camel-k-on-openshift"><a class="anchor" href="#camel-k-on-openshift"></a>Camel K on Openshift</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="introduction-10"><a class="anchor" href="#introduction-10"></a>Introduction</h3>
<div class="paragraph">
<p>Apache Camel K is a lightweight integration framework built from Apache Camel that runs natively on Kubernetes and is specifically designed for serverless and microservice architectures.</p>
</div>
<div class="paragraph">
<p>Users of Camel K can instantly run integration code written in Camel DSL on their preferred cloud (Kubernetes or OpenShift).</p>
</div>
<div class="paragraph">
<p>We are going to use a new project to create our Camel K integrations</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you are not already logged on go to the UI URL and login as userx (x is the number provided to you) and password openshift. Open another tab in the browser and go to the terminal URL provided and again logon as userx with password openshift
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="create-a-new-project"><a class="anchor" href="#create-a-new-project"></a>Create a new project</h3>
<div class="paragraph">
<p>In the browser based terminal window, create a new project called 'camelk-userx' where 'x' is your allocated user number</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">oc new-project camelk-userx</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="camel-k-and-the-operator-lifecycle-manager"><a class="anchor" href="#camel-k-and-the-operator-lifecycle-manager"></a>Camel K and the Operator Lifecycle Manager</h3>
<div class="sidebarblock">
<div class="content">
<div class="title">Camel K and the Operator Lifecycle Manager</div>
<div class="paragraph">
<p>Camel K uses the Operator Lifecycle manager, this means that new Custom Resource Definitions (CRDs) will be added to Openshift. These CRDs will extend the Openshift data model and allow Camel K to be managed using the standard ‘oc’ command. Installing operators requires a higher cluster privilage so the presenter will demonstrate the installation of the operator shortly.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Before installing Camel K, make sure that the CRDs do not exist.</p>
</div>
<div class="paragraph">
<p>In the terminal window type</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">oc whoami</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the response from the command is not your user name. Type ‘oc login’ and enter your username (userx) and password ‘openshift’. Rather than using your username and password, you could also use the recommended solution in the web console overview.</p>
</div>
<div class="paragraph">
<p>In the terminal browser window, type:-</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">oc get integrations
oc get integrationplatforms</code></pre>
</div>
</div>
<div class="paragraph">
<p>Both of these commands should return a <strong>resource type</strong> error</p>
</div>
<div class="paragraph">
<p><strong>'ADMIN only - Presenter demonstrates'</strong></p>
</div>
<div class="paragraph">
<p>Explain both of the above CRDs and what they are used for in Camel K</p>
</div>
<div class="paragraph">
<p>Install Camel K:</p>
</div>
<div class="paragraph">
<p>If you are not already logged on go to the UI URL and login as 'opentlc-mgr' (Don’t forget to explain that this is a cluster admin function) and the admin password</p>
</div>
<div class="paragraph">
<p>Make sure you are on the 'Administration View' in the console</p>
</div>
<div class="paragraph">
<p>Go to 'Operators/Operator Hub'</p>
</div>
<div class="paragraph">
<p>Search for 'camel k'</p>
</div>
<div class="paragraph">
<p>Install for all 'namespaces' in the cluster</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/camelk-1.png" alt="Camel K Operator Installation">
</div>
</div>
<div class="paragraph">
<p>Wait until the 'Camel K Operator' is shown as installed on the Operators/Installed Operators window</p>
</div>
<div class="paragraph">
<p><strong>'ADMIN only - finished'</strong></p>
</div>
<div class="paragraph">
<p>In the browser terminal window
Type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">oc get integrations
oc get integrationplatforms</code></pre>
</div>
</div>
<div class="paragraph">
<p>This time, both commands should return “no resources found”</p>
</div>
<div class="paragraph">
<p>Download the 'Camel K' examples using the browser terminal :-</p>
</div>
</div>
<div class="sect2">
<h3 id="download-and-configure-your-environment"><a class="anchor" href="#download-and-configure-your-environment"></a>Download and configure your environment</h3>
<div class="paragraph">
<p>Create a directory to download the examples</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">mkdir camel
cd camel</code></pre>
</div>
</div>
<div class="paragraph">
<p>Download the Camel K examples</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">wget https://github.com/pprosser-redhat/devex-camelk/raw/master/camelexamples/camel-k-examples-1.0.0-M4.tar.gz</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create a new directory for the examples</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">mkdir examples</code></pre>
</div>
</div>
<div class="paragraph">
<p>Uncompress the file</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">tar -xf camel-k-examples-1.0.0-M4.tar.gz -C examples</code></pre>
</div>
</div>
<div class="paragraph">
<p>To allow a developer to easily interact with an Openshift cluster, Camel K has it&#8217;s own command line interface. Download the 'Camel K cli' :-</p>
</div>
<div class="paragraph">
<p>In the same directory, type</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">wget https://github.com/pprosser-redhat/devex-camelk/raw/master/camelkcli/camel-k-client-1.0.0-M4-linux-64bit.tar.gz</code></pre>
</div>
</div>
<div class="paragraph">
<p>Uncompress the file</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">tar -xf camel-k-client-1.0.0-M4-linux-64bit.tar.gz</code></pre>
</div>
</div>
<div class="paragraph">
<p>Before we can create an integration, we need to add a Camel K 'IntegrationPlatform'.</p>
</div>
<div class="paragraph">
<p>In the terminal window, type</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">oc apply -f   https://raw.githubusercontent.com/pprosser-redhat/devex-camelk/master/camelkconfig/integrationplatform.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>You should now have all the pieces you need to start creating and deploying lightweight Camel Integrations to Openshift.</strong></p>
</div>
<div class="paragraph">
<p>If you type 'ls' on the command line, then you should see a similer list of files to those below</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/camelk-2.png" alt="Camel K file list">
</div>
</div>
</div>
<div class="sect2">
<h3 id="deploy-a-camel-k-interation"><a class="anchor" href="#deploy-a-camel-k-interation"></a>Deploy a Camel K Interation</h3>
<div class="paragraph">
<p>Firstly, let’s start by deploying a simple integration, type</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">./kamel run examples/simple.groovy</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The first time you deploy an Integration, it will take a few minutes. The operator manages all dependencies required by the Integration and downloads these from the Red Hat repository on demand. Once downloaded, the operator caches dependancies therefore subsequent deployments are significantly quicker. If you want to see what&#8217;s happen, in the terminal window type 'oc get pods', you will see that there are builds running
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can see what’s going on :-</p>
</div>
<div class="paragraph">
<p>If you go to the console UI in the Browser, make sure you are switched to 'Developer view'</p>
</div>
<div class="paragraph">
<p>Click on 'Topology'</p>
</div>
<div class="paragraph">
<p>Click on 'Simple' (this is your integration), and you can see what’s going on.</p>
</div>
<div class="paragraph">
<p>Once the pod has a dark blue ring around it, it is running, as per the screenshot below</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/camelk-3.png" alt="Running Integration">
</div>
</div>
<div class="paragraph">
<p>If you haven&#8217;t already, click 'inside the circle' to open the overview window</p>
</div>
<div class="paragraph">
<p>Click on 'Resources'</p>
</div>
<div class="paragraph">
<p>Click on 'Pods &#8594; simple-xxxxxxxx' (xxxxxxx is randomly generated)</p>
</div>
<div class="paragraph">
<p>Click on 'Logs' to see the output from the integration, it should look similer to the screenshot below</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/camelk-4.png" alt="Integration logs">
</div>
</div>
<div class="paragraph">
<p>The integration is a simple timer that triggers every 1 second and writes to the log file.</p>
</div>
<div class="paragraph">
<p>In the Terminal Browser window type</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">oc get integrations</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should now see an integration called 'simple' in the list.</p>
</div>
<div class="paragraph">
<p>In the Terminal browser window type</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell"> oc describe integration simple</code></pre>
</div>
</div>
<div class="paragraph">
<p>You’ll see the “Integration” CRD definition that includes the integration defined as groovy code.</p>
</div>
<div class="paragraph">
<p>Let’s make a change to the integration</p>
</div>
<div class="paragraph">
<p>In the browser terminal window</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">vi examples/simple.groovy</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will see the text - 'Hello Camel K from ${routeId}'</p>
</div>
<div class="paragraph">
<p>Change the text e.g. 'Hello Camel K from ${routeId}. Added some more text'</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
To change the text, use the arrow gets to move to the text you want to change, press 'i', and type in the text. To save, press 'esc' and type ':wq' followed by 'enter'
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now, you need to deploy this integration to Openshift again to test</p>
</div>
<div class="paragraph">
<p>Type</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">./kamel run examples/simple.groovy</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are quick enough (you need to be really quick!), you’ll see the integration doing a rolling deployment</p>
</div>
<div class="paragraph">
<p>Look at the log file again (as above) to see if the change has been deployed</p>
</div>
</div>
<div class="sect2">
<h3 id="deploy-camel-k-in-developer-mode"><a class="anchor" href="#deploy-camel-k-in-developer-mode"></a>Deploy Camel K in Developer mode</h3>
<div class="paragraph">
<p><strong>While the process of redeploying is simple, it isn’t very developer friendly. The 'kamel' cli has a developer friendly “hot deploy” mode that makes this experience much better</strong></p>
</div>
<div class="paragraph">
<p>Let&#8217;s try it out :-</p>
</div>
<div class="paragraph">
<p>Delete the integration :-
There are 2 ways you can do this in the Terminal Browser window (your choice) :-</p>
</div>
<div class="paragraph">
<p>Use the “kamel” cli</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">./kamel delete simple</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or</p>
</div>
<div class="paragraph">
<p>Use the Openshift cli</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">oc delete integration simple</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This is the great thing about CRDs, you can use the normal Openshift cli to managed the custom data model (integrations in this case)
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Lets deploy the integration in developer mode, type</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">./kamel run examples/simple.groovy --dev</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will see the deployment phases logged on the screen, followed by the log outputting automatically from the integration pod, useful for a developer to see what’s going on. The output should look similer to the screenshot below</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/camelk-5.png" alt="Developer Mode">
</div>
</div>
<div class="paragraph">
<p>For the next exercise, you will need 2 terminal windows.</p>
</div>
<div class="paragraph">
<p>Copy the URL for the “browser terminal” and paste into a new browser tab</p>
</div>
<div class="paragraph">
<p>It should look something like :-
<a href="https://xxxxxxxxxxxxx/terminal/session/1" class="bare">https://xxxxxxxxxxxxx/terminal/session/1</a></p>
</div>
<div class="paragraph">
<p><strong>You will notice that the terminal window is also outputting the log, you need to create a new terminal session</strong></p>
</div>
<div class="paragraph">
<p>Change the url to a new session number e.g.
<a href="https://xxxxxxxxxxxxx/terminal/session/2" class="bare">https://xxxxxxxxxxxxx/terminal/session/2</a></p>
</div>
<div class="paragraph">
<p>In the new terminal, make sure you go back to the camel directory - if you followed the instructions, it will be called 'camel' (cd 'camel')</p>
</div>
<div class="paragraph">
<p>Make another change to the text in “simple.groovy” by following the same instructions above</p>
</div>
<div class="paragraph">
<p>Once you have saved the changes, go back to the browser terminal tab outputting the log.</p>
</div>
<div class="paragraph">
<p>You should see that the changes have been automatically applied to the running integration, without the need to redeploy</p>
</div>
<div class="paragraph">
<p><strong>That’s a much better way of round trip development of integrations…</strong></p>
</div>
<div class="paragraph">
<p>Go back to the browser terminal that’s outputting the log, press ‘ctrl c’</p>
</div>
<div class="paragraph">
<p>Look at the Topology view in the Openshift console(or oc get integrations)</p>
</div>
<div class="paragraph">
<p>The integration should have been deleted -</p>
</div>
<div class="paragraph">
<p><strong>Just like a developer would see by pressing 'ctrl c' on a Java application running on their laptop</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="optional-labs"><a class="anchor" href="#optional-labs"></a>Optional labs</h3>
<div class="paragraph">
<p>Feel free to take a look at some of the other examples</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Instructions on how to run the integrations are in the integration source code
E.g. ./kamel run --name=rest-with-restlet --dependency=camel-rest --dependency=camel-restlet examples/RestWithRestlet.java
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The example above demonstrates Camel K deploying a Java based Camel Route that exposes a Restful service via an Openshift route - the Camel K operator does all the hard work for you</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
some of the examples might take a little longer to deploy as the operator will need to download more dependencies
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To test the rest api, you need to know what the Openshift Route is</p>
</div>
<div class="paragraph">
<p>In the Developer UI, go back to the Topology view, and click on “rest-with-restlet” application</p>
</div>
<div class="paragraph">
<p>Click on resources, and you will see the http route at the bottom of the page</p>
</div>
<div class="paragraph">
<p>Click on the http link</p>
</div>
<div class="paragraph">
<p>You will get an error as the integration will only response to /hello. Append ‘/hello’ to the URI
Now you should see a response</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="camel-k-and-openshift-serverless"><a class="anchor" href="#camel-k-and-openshift-serverless"></a>Camel K and Openshift Serverless</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="introduction-11"><a class="anchor" href="#introduction-11"></a>Introduction</h3>
<div class="paragraph">
<p>Openshift Serverless, based on Knative is the serverless technology that was introduced in Openshift 4.2. Openshift Serverless enables Pods running on Openshift to be scaled to 0 therefore taking zero processing power. Only when called, Openshift Serverless will scale the Pod up on demand before processing the request. Openshift Serverless also has the ability to autoscale based on load before eventually scaling back to zero when no requests are being received.</p>
</div>
<div class="paragraph">
<p>Openshift Serverless supports "Serving" and "Eventing"</p>
</div>
<div class="paragraph">
<p>"Serving" enables request/response workloads, and Eventing enables asynchronous event based workloads using cloudevents. In this lab, we are going to look at eventing, and how easy it is to integration with Camel K.</p>
</div>
</div>
<div class="sect2">
<h3 id="create-a-new-project-2"><a class="anchor" href="#create-a-new-project-2"></a>Create a new project</h3>
<div class="paragraph">
<p>In the browser based terminal window, create a new project called 'knative-userx' where 'x' is your allocated user number</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">oc new-project knative-userx</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="openshift-serverless-and-the-operator-lifecycle-manager"><a class="anchor" href="#openshift-serverless-and-the-operator-lifecycle-manager"></a>Openshift Serverless and the Operator Lifecycle Manager</h3>
<div class="sidebarblock">
<div class="content">
<div class="title">Openshift Serverless and the Operator Lifecycle Manager</div>
<div class="paragraph">
<p>Openshift Serverless uses the Operator Lifecycle manager, this means that its operator and Custom Resource Definitions (CRDs) will be added to Openshift via "OLM". Once created, the new CRDs will extend the Openshift data model allowing Openshift Serverless to be managed using the standard ‘oc’ command. Installing operators requires a higher cluster privilage so the presenter will demonstrate the installation of the operator shortly.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="install-openshift-serverless"><a class="anchor" href="#install-openshift-serverless"></a>Install Openshift Serverless</h3>
<div class="paragraph">
<p>The Openshift Serverless operator has to be installed by a higher level privilage. The presenter with demonstrate this to you shortly.</p>
</div>
<div class="paragraph">
<p><strong>'ADMIN only - Presenter demonstrates'</strong></p>
</div>
<div class="paragraph">
<p>Ensure that the Camel K operator is installed. Instructions can be found in the Camel K on Openshift lab guide.</p>
</div>
<div class="paragraph">
<p>Install Openshift Serverless:</p>
</div>
<div class="paragraph">
<p>If you are not already logged on go to the UI URL and login as 'opentlc-mgr' (Don’t forget to explain that this is a cluster admin function) and the admin password</p>
</div>
<div class="paragraph">
<p>Make sure you are on the 'Administration View' in the console</p>
</div>
<div class="paragraph">
<p>Go to 'Operators/Operator Hub'</p>
</div>
<div class="paragraph">
<p>Search for 'openshift serverless'</p>
</div>
<div class="paragraph">
<p>Install for all 'namespaces' in the cluster</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/camekknative-1.png" alt="Serverless Operator Installation">
</div>
</div>
<div class="paragraph">
<p>Wait until 'Openshift Serverless' is shown as installed on the Operators/Installed Operators window</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When complete, Status will say 'InstallSucceeded'
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Create a new project called knative-serving</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Make sure you create the knative-serving project as cluster admin (opentlc-mgr)
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">oc new-project knative-serving</code></pre>
</div>
</div>
<div class="paragraph">
<p>add Knative Serving custom resource definition</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">oc apply -f https://raw.githubusercontent.com/pprosser-redhat/devex-camelk/master/knative/serving.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Wait for Knative serving to be ready, you can check this by typing the following (This will take a few minutes)</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">oc get KnativeServing</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once Knative Serving is ready, it will look like the screenshot below</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/camekknative-2.png" alt="Knative Serving Ready">
</div>
</div>
<div class="paragraph">
<p><strong>Now install Knative eventing</strong></p>
</div>
<div class="paragraph">
<p>Go to 'Operators/Operator Hub'</p>
</div>
<div class="paragraph">
<p>Search for 'knative eventing'</p>
</div>
<div class="paragraph">
<p>Click on 'Knative Eventing Operator'</p>
</div>
<div class="paragraph">
<p>Install for all 'namespaces' in the cluster as per the screenshot below</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/camekknative-3.png" alt="Knative Eventing">
</div>
</div>
<div class="paragraph">
<p>Wait for the Operator to complete its installation</p>
</div>
<div class="paragraph">
<p><strong>'ADMIN only - finished'</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="download-and-configure-your-environment-2"><a class="anchor" href="#download-and-configure-your-environment-2"></a>Download and configure your environment</h3>
<div class="paragraph">
<p><strong>If you completed the 'Camel K' on Openshift lab then you do not need to follow this set of instructions. Move on to 'Create Knative Messaging Channel'</strong></p>
</div>
<div class="paragraph">
<p>Create a directory to download the examples</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">mkdir camel
cd camel</code></pre>
</div>
</div>
<div class="paragraph">
<p>Download the Camel K examples</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">wget https://github.com/pprosser-redhat/devex-camelk/raw/master/camelexamples/camel-k-examples-1.0.0-M4.tar.gz</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create a new directory for the examples</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">mkdir examples</code></pre>
</div>
</div>
<div class="paragraph">
<p>Uncompress the file</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">tar -xf camel-k-examples-1.0.0-M4.tar.gz -C examples</code></pre>
</div>
</div>
<div class="paragraph">
<p>To allow a developer to easily interact with an Openshift cluster, Camel K has it&#8217;s own command line interface. Download the 'Camel K cli' :-</p>
</div>
<div class="paragraph">
<p>In the same directory, type</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">wget https://github.com/pprosser-redhat/devex-camelk/raw/master/camelkcli/camel-k-client-1.0.0-M4-linux-64bit.tar.gz</code></pre>
</div>
</div>
<div class="paragraph">
<p>Uncompress the file</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">tar -xf camel-k-client-1.0.0-M4-linux-64bit.tar.gz</code></pre>
</div>
</div>
<div class="paragraph">
<p>Before we can create an integration, we need to add a Camel K 'IntegrationPlatform'.</p>
</div>
<div class="paragraph">
<p>In the terminal window, type</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">oc apply -f   https://raw.githubusercontent.com/pprosser-redhat/devex-camelk/master/camelkconfig/integrationplatform.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>You should now have all the pieces you need to start creating and deploying lightweight Camel Integrations to Openshift.</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="create-knative-messaging-channel"><a class="anchor" href="#create-knative-messaging-channel"></a>Create Knative Messaging Channel</h3>
<div class="paragraph">
<p>By default, Knative uses an in memory messaging channel. In this lab we will configure 2 of these channels to use with Camel K</p>
</div>
<div class="paragraph">
<p>In the browser terminal window</p>
</div>
<div class="paragraph">
<p>Type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">oc apply -f examples/knative/messages-channel.yaml
oc apply -f examples/knative/words-channel.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Make sure the channels have been created correctly</p>
</div>
<div class="paragraph">
<p>Type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">oc get InMemoryChannel</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see a screenshot like the one below</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/camekknative-4.png" alt="InMemory Channels Ready">
</div>
</div>
<div class="paragraph">
<p>You are looking for 'Ready' to be 'True'</p>
</div>
</div>
<div class="sect2">
<h3 id="deploy-the-integrations"><a class="anchor" href="#deploy-the-integrations"></a>Deploy the Integrations</h3>
<div class="sidebarblock">
<div class="content">
<div class="title">Introduction to the integrations that we will use</div>
<div class="paragraph">
<p>Now that we have deployed 2 message channels, we will deploy 3 Camel K Integrations. 'feed.groovy' will generate a simple sentence every 3 seconds, and send this to the 'message channel', 'splitter.groovy' will subscribe to the 'message channel', take the message, split the message into individual words before sending the individual words to 'words channel'. Finally, 'printer.groovy' will subscribe to the 'words.channel', read the words from the channel and print them to the output log.</p>
</div>
<div class="paragraph">
<p>The flow looks like :-</p>
</div>
<div class="paragraph">
<p>feed &#8594; message channel &#8594; spilter &#8594; words channel &#8594; printer</p>
</div>
</div>
</div>
<div class="paragraph">
<p>In the terminal window, deploy the 3 integrations</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">./kamel run examples/knative/feed.groovy
./kamel run examples/knative/splitter.groovy
./kamel run examples/knative/printer.groovy</code></pre>
</div>
</div>
<div class="paragraph">
<p>Go to the developer view in the Openshift Console</p>
</div>
<div class="paragraph">
<p>Make sure you have chosen the project 'knative-user1'</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If this is the first time you&#8217;ve deployed a Camel K integration, it will take a few minutes to download the dependancies
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Until the 'splitter.grovy' integration deploys, expect to see errors from the 'feed.groovy' integration.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once, all 3 of the Integrations are deployed, the topology view should look like the screnshot below</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/camekknative-5.png" alt="Integrations running">
</div>
</div>
<div class="paragraph">
<p>Each of the integrations is producing log information. To view the log for a running pod in the console</p>
</div>
<div class="paragraph">
<p>In the topology view,</p>
</div>
<div class="paragraph">
<p>Click inside the circle of an Integration to see the pop window, make sure the overview tab is selected. If should look like the screenshot below:-</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/camekknative-6.png" alt="Viewing overview of running Integration">
</div>
</div>
<div class="paragraph">
<p>On the overview page, you will see a 'pod selector'.</p>
</div>
<div class="paragraph">
<p>'Click' on the pod selector</p>
</div>
<div class="paragraph">
<p>This will show you a screen like the one below:-</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/camekknative-7.png" alt="Running Pod">
</div>
</div>
<div class="paragraph">
<p>'Click' on row entry under name e.g. splitter-zpsqt-deployment-77f946649-tfg5q in the screenshot above</p>
</div>
<div class="paragraph">
<p>This will show you the pod details screen like the one below</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/camekknative-8.png" alt="Pod Details">
</div>
</div>
<div class="paragraph">
<p>'Click' on 'Logs' to view the log for the pod. It should look something like the one below</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/camekknative-9.png" alt="Pod Details">
</div>
</div>
<div class="paragraph">
<p>Repeat the steps above for the other 3 Integrations.</p>
</div>
</div>
<div class="sect2">
<h3 id="knative-in-action"><a class="anchor" href="#knative-in-action"></a>Knative in action</h3>
<div class="paragraph">
<p>Make sure you are in the developer portal, looking at the Topology view before continuing</p>
</div>
<div class="paragraph">
<p>The 2 Integrations "hooked" into Knative Eventing are the 'spilter' and 'printer' integrations.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s see if the promise of scale to zero works.</p>
</div>
<div class="paragraph">
<p>To stop the integrations, we need to stop messages arriving at the "messages.channel". To do this, we need to stop the feed integration.</p>
</div>
<div class="paragraph">
<p>Lets delete the 'feed.groovy' integration</p>
</div>
<div class="paragraph">
<p>In the terminal browser window, type</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">./kamel delete feed</code></pre>
</div>
</div>
<div class="paragraph">
<p>Go back to the topology view, you will notice that the feed integration has gone.</p>
</div>
<div class="paragraph">
<p>Show some patience now, keep lookng at the topology view, we are waiting (and hoping!) that the integrations scale down to zero.</p>
</div>
<div class="paragraph">
<p>You will know when this starts as the rings around the circles will change from the normal blue to a very dark blue, before going white. Once they are white, the integrations are scaled to zero just like the screenshot below</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/camekknative-10.png" alt="Scaled to zero">
</div>
</div>
<div class="paragraph">
<p>To wake the Integrations up again, redeploy the 'feed' integration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">./kamel run examples/knative/feed.groovy</code></pre>
</div>
</div>
<div class="paragraph">
<p>Go back to the topology view and you should see the 'feed' integration redeploy, and the 'spillter' and 'printer' integrations awake from their slumber!</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 1.0.0<br>
Last updated 2020-01-03 18:30:42 UTC
</div>
</div>
</body>
</html>